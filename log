==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7ffc88b01e30 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e5908)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7ffc88b01e30 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::CreateColumnFamilyImpl(rocksdb::ColumnFamilyOptions const&, std::string const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1584 (titan_thread_safety_test+0x6a04be)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1521 (titan_thread_safety_test+0x69fef0)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:276 (titan_thread_safety_test+0x625d81)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610d4a)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c502)
    #7 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #8 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #9 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #10 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #11 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #12 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #13 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #14 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #15 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001ce30)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd7973b46d0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e5908)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd7973b46d0 by thread T8:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9e1c)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T8.

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd796bb35e0 by thread T8 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x85993b)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa0f4)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd796bb35e0 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x858183)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e407d)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x98655e)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1b3c)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x697060)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62572a)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7ffc88b01cc0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e5908)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7ffc88b01cc0 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a7888)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1531 (titan_thread_safety_test+0x69ff6c)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:276 (titan_thread_safety_test+0x625d81)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610d4a)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c502)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001ccc0)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd7982be5e0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x85851a)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e48b8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd7982be5e0 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x858183)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e407d)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 4 at 0x7b1800015fe0 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670b2a)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843a7e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4a10)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b1800015fe0 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b1800015ff0 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e82d4)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e863d)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800015ff7 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:644 (titan_thread_safety_test+0x843d0c)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843dde)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec47c)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd795bb16d0 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x859046)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e44f2)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd795bb16d0 by thread T11:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9e1c)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7fd7973b46d8 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x857a2c)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x859046)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e44f2)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7fd7973b46d8 by thread T8 (mutexes: write M927):
    #0 void std::swap<rocksdb::FileMetaData**>(rocksdb::FileMetaData**&, rocksdb::FileMetaData**&) /usr/include/c++/4.8.2/bits/move.h:176 (titan_thread_safety_test+0x9b4060)
    #1 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl::_M_swap_data(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl&) /usr/include/c++/4.8.2/bits/stl_vector.h:104 (titan_thread_safety_test+0x9b3d67)
    #2 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_base(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:144 (titan_thread_safety_test+0x9b3797)
    #3 std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::vector(std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:328 (titan_thread_safety_test+0x9b2f31)
    #4 rocksdb::Compaction::Compaction(rocksdb::VersionStorageInfo*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, std::vector<rocksdb::CompactionInputFiles, std::allocator<rocksdb::CompactionInputFiles> >, int, unsigned long, unsigned long, unsigned int, rocksdb::CompressionType, rocksdb::CompressionOptions, unsigned int, std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >, bool, double, bool, rocksdb::CompactionReason) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:245 (titan_thread_safety_test+0x9b0a8c)
    #5 rocksdb::CompactionPicker::CompactRange(std::string const&, rocksdb::MutableCFOptions const&, rocksdb::VersionStorageInfo*, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_picker.cc:732 (titan_thread_safety_test+0x9d5fe2)
    #6 rocksdb::ColumnFamilyData::CompactRange(rocksdb::MutableCFOptions const&, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:995 (titan_thread_safety_test+0x9a1731)
    #7 rocksdb::DBImpl::RunManualCompaction(rocksdb::ColumnFamilyData*, int, int, unsigned int, unsigned int, rocksdb::Slice const*, rocksdb::Slice const*, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1387 (titan_thread_safety_test+0x6f95b2)
    #8 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:715 (titan_thread_safety_test+0x6f506f)
    #9 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T8.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x98655e)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1b3c)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x697060)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62572a)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000207b8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2ca2)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b51e9)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000207b8 by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ad06c)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800020400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 4 at 0x7b1800009020 by thread T10:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670b2a)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843a7e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4a10)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800009023 by thread T7:
    #0 memset <null> (libtsan.so.0+0x32235)
    #1 std::string::append(unsigned long, char) <null> (libstdc++.so.6+0xd528b)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800009000 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000207cb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000207cb by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800020400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b1800009027 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e82d4)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e863d)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800009027 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843cf2)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843dde)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec47c)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800009000 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b78000207c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670b81)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x6863b1)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b5286)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000207c3 by thread T7:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757a68)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad0e6)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800020400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b7800031c0b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c0b by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b7800031bff by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f6f8)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9305bf)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b54a2)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031bff by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b7800031c0c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f4bd)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f641)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a978)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6859f1)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x685554)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c0c by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b180001c320 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860bc1)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b54d4)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b41f6)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7ac05b)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e487)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180001c320 by thread T10:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac3e4)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac5df)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x847190)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x848518)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845cfe)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7fd7982be550 by thread T13:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 (titan_thread_safety_test+0x8586fe)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e48b8)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7fd7982be550 by thread T10:
    #0 rocksdb::WriteThread::CompleteParallelMemTableWriter(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:578 (titan_thread_safety_test+0x858e74)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:387 (titan_thread_safety_test+0x6e5633)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b180001c2c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860bc1)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b54d4)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b41f6)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7ac06d)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e487)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180001c2c0 by thread T10:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad02d)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800031800 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800031800 by thread T10:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863b2d)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800031838 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031838 by thread T10:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x848a18)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000318a0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000318a0 by thread T10:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862498)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7fd7982be558 by thread T13:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 (titan_thread_safety_test+0x6e5162)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7fd7982be558 by thread T10:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:349 (titan_thread_safety_test+0x6e5301)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 in rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000318e8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000318e8 by thread T10:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b64a1)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b537e)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b3a93)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b3568)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b126e)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8624ce)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800031bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031bbf by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86448e)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800031bf0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031bf0 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x865280)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863b69)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7fd7982be5e8 by thread T16:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x857a2c)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e5908)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7fd7982be5e8 by thread T7:
    #0 rocksdb::WriteThread::WriteGroup::Iterator::operator++() /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.h:100 (titan_thread_safety_test+0x6ecf96)
    #1 rocksdb::WriteThread::LaunchParallelMemTableWriters(rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:569 (titan_thread_safety_test+0x858e29)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:341 (titan_thread_safety_test+0x6e52a3)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T16 (tid=64762, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780003357d by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f4bd)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f641)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a978)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6859f1)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x685554)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780003357d by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800033000 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000423cb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000423cb by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800042000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b78000423c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670b81)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x6863b1)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b5286)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000423c3 by thread T13:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757a68)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad0e6)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800042000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000423cf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa276e6)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x685522)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000423cf by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800042000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b18000234c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860bc1)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b54d4)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b41f6)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7ac05b)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e487)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b18000234c0 by thread T13:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac3e4)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac5df)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x847190)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x848518)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845cfe)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7fd78f1be5e8 by thread T11 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x857a2c)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x85993b)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa0f4)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7fd78f1be5e8 by thread T10:
    #0 rocksdb::WriteThread::WriteGroup::Iterator::operator++() /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.h:100 (titan_thread_safety_test+0x6ecf96)
    #1 rocksdb::WriteThread::LaunchParallelMemTableWriters(rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:569 (titan_thread_safety_test+0x858e29)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:341 (titan_thread_safety_test+0x6e52a3)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x98655e)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1b3c)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x697060)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62572a)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b1800023460 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860bc1)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b54d4)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b41f6)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7ac06d)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e487)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b1800023460 by thread T13:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad02d)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800042000 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800042000 by thread T13:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863b2d)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800042038 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800042038 by thread T13:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x848a18)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000420a0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000420a0 by thread T13:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862498)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000420e8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000420e8 by thread T13:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b64a1)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b537e)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b3a93)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b3568)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b126e)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8624ce)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000423b0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000423b3 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x86520c)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8624f2)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000423b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000423be by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86495e)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780003580b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780003580b by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800035400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000357f9 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f6f8)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9305bf)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b54a2)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000357f9 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800035400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000357b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000357be by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac83d)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865d24)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000357c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000357c1 by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86448e)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000357f0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000357f0 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x865280)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863b69)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b7800045fbf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::IterKey::SetKeyImpl(rocksdb::Slice const&, bool) <null> (titan_thread_safety_test+0x757f92)
    #2 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:416 (titan_thread_safety_test+0x7869ef)
    #3 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:424 (titan_thread_safety_test+0x9b7067)
    #4 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:253 (titan_thread_safety_test+0x9b54f8)
    #5 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #6 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #7 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #8 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #9 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #10 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #11 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #12 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #13 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #14 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #15 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #16 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #17 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #20 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #21 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #22 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800045fbf by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800045c00 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b7800045fcd by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa276e6)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x685522)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800045fcd by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800045c00 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b7800037c03 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670b81)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x6863b1)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b5286)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800037c03 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757a68)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad0e6)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800037800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800037bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800037bbd by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864299)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800046bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800046bbe by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac83d)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865d24)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800046bf0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800046bf0 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x86520c)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8624f2)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c99)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x86074f)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ad04b)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800046bf8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800046bfd by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86495e)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b780002a44b by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670b81)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x6863b1)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b5286)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b780002a44b by thread T7:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757a68)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad0e6)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002a000 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800048fb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800048fbd by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864299)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780002bbb8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2ca2)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b51e9)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780002bbb8 by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ad06c)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002b800 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780002bbbf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::IterKey::SetKeyImpl(rocksdb::Slice const&, bool) <null> (titan_thread_safety_test+0x757f92)
    #2 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:416 (titan_thread_safety_test+0x7869ef)
    #3 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:424 (titan_thread_safety_test+0x9b7067)
    #4 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:253 (titan_thread_safety_test+0x9b54f8)
    #5 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4b8b)
    #6 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x999021)
    #7 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #8 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #9 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #10 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #11 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #12 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #13 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #14 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #15 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #16 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #17 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #20 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #21 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #22 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780002bbbf by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002b800 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T8 (tid=64753, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800060fc0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800060fc6 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864b12)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b780002d3c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780002d3c0 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac83d)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865cdd)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd796bb3910 by thread T16:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x859046)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e44f2)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd796bb3910 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9e1c)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f8707)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62edc4)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b49b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T16 (tid=64762, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd7982be910 by thread T17 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x85993b)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa0f4)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd7982be910 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9e1c)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f8707)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62edc4)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b49b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x98655e)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1b3c)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x697060)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62572a)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T17 (tid=64763, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000783b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000783b8 by thread T7:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac81a)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865d24)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800063fb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800063fb8 by thread T13:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac81a)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865cdd)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000747c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000747c0 by thread T10:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac81a)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865d24)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b7800076bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800076bbe by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac7dd)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x865850)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865c92)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000c93f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000c93fd by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x676345)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x93057b)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76152b)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac83d)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865392)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865cdd)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x86551c)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8640a3)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T16 (tid=64762, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 1 at 0x7bc4000dc000 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab505)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7bc4000dc000 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab505)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000dc000 allocated by thread T11:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eba35)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 1 at 0x7bc4000dc007 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab558)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7bc4000dc007 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab558)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000dc000 allocated by thread T11:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eba35)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000c4c38 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2ca2)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b51e9)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000c4c38 by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ad06c)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000c4800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 8 at 0x7b78000a17f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e48f)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3c0d)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b41c3)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd77a)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000a17f8 by thread T13:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:230 (titan_thread_safety_test+0x7ac7a6)
    #3 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86448e)
    #4 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861e4e)
    #5 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860901)
    #6 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad6b6)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 4 at 0x7b180000ea20 by thread T16:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670b2a)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843a7e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4a10)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b180000ea20 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180000ea00 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T16 (tid=64762, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b180000ea30 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e82d4)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e863d)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bd01)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180000ea37 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:644 (titan_thread_safety_test+0x843d0c)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843dde)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec47c)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180000ea00 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T16 (tid=64762, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000ca053 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000ca053 by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000c9c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000ca049 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f6f8)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9305bf)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b54a2)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000ca049 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000c9c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b78000ca054 by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f4bd)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f641)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a978)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6859f1)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x685554)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000ca054 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e53fd)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000c9c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780007a80b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cd83)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0bdb)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2d86)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b5234)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780007a80b by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fdd1)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad0fc)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780007a400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780007a802 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f6f8)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9305bf)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b54a2)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4d7b)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x999141)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780007a802 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad097)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780007a400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b780007a80c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f4bd)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f641)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a978)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6859f1)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x685554)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x99907f)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a580)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x7790ad)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f1606)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1d0e)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fd070)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd42c)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc4cf)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ced)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43fcd)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42710)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x634635)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dee1)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3e05d)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46b4a)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa4698b)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa468ef)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780007a80c by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad127)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848a7d)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x849272)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842bf5)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845c73)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e41e1)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780007a400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0ba8)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6ebb19)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=64713, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e28d)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e15d)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ec72)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bb5c)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730a1c)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696edf)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7375c3)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x737366)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x6250ee)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620fb8)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620e09)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611583)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c1ad)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T11 (tid=64756, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 4 at 0x7b1800062000 by thread T13:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670b2a)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843a7e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4a10)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b1800062000 by thread T7:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x670bee)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x843acd)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843c8b)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843dde)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec47c)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800061fe0 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 1 at 0x7b1800062007 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e82d4)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e863d)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800062007 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843cf2)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843dde)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec47c)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800061fe0 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7b1800062008 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e82d4)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e863d)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b1800062008 by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800061fe0 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec457)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd78cfbdbd0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x85851a)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e48b8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd78cfbdbd0 by thread T17:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0ecb)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0baa)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x6260ba)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60bf39)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T17.

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T17 (tid=64763, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd78cfbd7c0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x85851a)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e48b8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd78cfbd7c0 by thread T17:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a7888)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0c29)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x6260ba)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60bf39)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T17.

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T17 (tid=64763, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd7982bebd0 by thread T17:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x85993b)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2814 (titan_thread_safety_test+0x6a7bf6)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0c29)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x6260ba)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60bf39)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd7982bebd0 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0ecb)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0baa)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x6260ba)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60bf39)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T17 (tid=64763, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Read of size 8 at 0x7fd7982be7c0 by thread T13:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x857997)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8595df)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x859046)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e44f2)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fd7982be7c0 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x85778e)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8597c1)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a7888)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0c29)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x6260ba)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60bf39)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T10 (tid=64755, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 1 at 0x7bc40003c005 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab505)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7bc40003c005 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab505)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc40003c000 allocated by thread T14:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eba35)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, finished) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=64710)
  Write of size 1 at 0x7bc40003c007 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab558)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7bc40003c007 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x949653)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9459db)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab558)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab21f)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e847e)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8791)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d90)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3a4e)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec4cf)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e37f9)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611bcc)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60ce46)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc40003c000 allocated by thread T14:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eba35)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9eaa)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4c6f)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cfc9)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6145a4)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bdab)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f155)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60f03b)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef9f)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=64759, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T7 (tid=64752, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d306)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd98)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

  Thread T14 (tid=64760, finished) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60db27)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60da1f)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d26a)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cd64)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c764)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac704e)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac103d)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa39da)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa4277)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a95)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac497)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac8038)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1f07)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaaeda)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6111a0)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60cabb)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
ThreadSanitizer: reported 87 warnings
