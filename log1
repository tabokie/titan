==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7fffa9009050 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffa9009050 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::CreateColumnFamilyImpl(rocksdb::ColumnFamilyOptions const&, std::string const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1584 (titan_thread_safety_test+0x6a0432)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1521 (titan_thread_safety_test+0x69fe64)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:276 (titan_thread_safety_test+0x625cf5)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610cbe)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c476)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001d050)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c97ab46e0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c97ab46e0 by thread T8:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9d90)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T8.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c972b35f0 by thread T8 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x8598af)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa068)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c972b35f0 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x8580f7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3ff1)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x9864d2)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1ab0)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696fd4)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62569e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7fffa9008ee0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffa9008ee0 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a77fc)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1531 (titan_thread_safety_test+0x69fee0)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:276 (titan_thread_safety_test+0x625cf5)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610cbe)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c476)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001cee0)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c989be5f0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x85848e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e482c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c989be5f0 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x8580f7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3ff1)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 4 at 0x7b1800015fe0 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670a9e)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x8439f2)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4984)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b1800015fe0 by thread T10:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x670b62)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x843a41)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843bff)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b1800015fe7 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800015fe7 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843c66)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b1800015fe8 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b1800015fe8 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c962b16e0 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858fba)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e4466)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c962b16e0 by thread T11:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9d90)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c97ab46e8 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x8579a0)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858fba)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e4466)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c97ab46e8 by thread T8 (mutexes: write M927):
    #0 void std::swap<rocksdb::FileMetaData**>(rocksdb::FileMetaData**&, rocksdb::FileMetaData**&) /usr/include/c++/4.8.2/bits/move.h:176 (titan_thread_safety_test+0x9b3fd4)
    #1 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl::_M_swap_data(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl&) /usr/include/c++/4.8.2/bits/stl_vector.h:104 (titan_thread_safety_test+0x9b3cdb)
    #2 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_base(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:144 (titan_thread_safety_test+0x9b370b)
    #3 std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::vector(std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:328 (titan_thread_safety_test+0x9b2ea5)
    #4 rocksdb::Compaction::Compaction(rocksdb::VersionStorageInfo*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, std::vector<rocksdb::CompactionInputFiles, std::allocator<rocksdb::CompactionInputFiles> >, int, unsigned long, unsigned long, unsigned int, rocksdb::CompressionType, rocksdb::CompressionOptions, unsigned int, std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >, bool, double, bool, rocksdb::CompactionReason) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:245 (titan_thread_safety_test+0x9b0a00)
    #5 rocksdb::CompactionPicker::CompactRange(std::string const&, rocksdb::MutableCFOptions const&, rocksdb::VersionStorageInfo*, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_picker.cc:732 (titan_thread_safety_test+0x9d5f56)
    #6 rocksdb::ColumnFamilyData::CompactRange(rocksdb::MutableCFOptions const&, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:995 (titan_thread_safety_test+0x9a16a5)
    #7 rocksdb::DBImpl::RunManualCompaction(rocksdb::ColumnFamilyData*, int, int, unsigned int, unsigned int, rocksdb::Slice const*, rocksdb::Slice const*, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1387 (titan_thread_safety_test+0x6f9526)
    #8 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:715 (titan_thread_safety_test+0x6f4fe3)
    #9 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T8.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x9864d2)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1ab0)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696fd4)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62569e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b78000207c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670af5)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686325)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b51fa)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000207c3 by thread T7:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x7579dc)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad05a)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800020400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7fffa9008e18 by thread T10:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:433 (titan_thread_safety_test+0x8584cc)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e482c)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffa9008e18 by main thread:
    #0 void std::swap<char const*>(char const*&, char const*&) /usr/include/c++/4.8.2/bits/move.h:175 (titan_thread_safety_test+0x632ab8)
    #1 rocksdb::Status::operator=(rocksdb::Status&&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/status.h:336 (titan_thread_safety_test+0x62990b)
    #2 rocksdb::Status::Status(rocksdb::Status&&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/status.h:319 (titan_thread_safety_test+0x6297e9)
    #3 rocksdb::DBImpl::CreateColumnFamilyImpl(rocksdb::ColumnFamilyOptions const&, std::string const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1629 (titan_thread_safety_test+0x6a08b5)
    #4 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1521 (titan_thread_safety_test+0x69fe64)
    #5 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:276 (titan_thread_safety_test+0x625cf5)
    #6 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610cbe)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c476)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001ce18)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:433 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 4 at 0x7b1800009020 by thread T10:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670a9e)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x8439f2)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4984)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b1800009020 by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800009000 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b1800009030 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800009037 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:644 (titan_thread_safety_test+0x843c80)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800009000 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c972b3560 by thread T10:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 (titan_thread_safety_test+0x858672)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e482c)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c972b3560 by thread T7:
    #0 rocksdb::WriteThread::CompleteParallelMemTableWriter(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:578 (titan_thread_safety_test+0x858de8)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:387 (titan_thread_safety_test+0x6e55a7)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800021fcb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2cfa)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b51a8)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800021fcb by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad070)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800021c00 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800021fcd by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f431)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f5b5)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a8ec)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x685965)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x6854c8)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800021fcd by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800021c00 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b180000c4e0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860b35)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b5448)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b416a)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abfcf)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e3fb)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180000c4e0 by thread T7:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac358)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac553)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x847104)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x84848c)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845c72)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c972b3568 by thread T10:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 (titan_thread_safety_test+0x6e50d6)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c972b3568 by thread T7:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:349 (titan_thread_safety_test+0x6e5275)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 in rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b180000c480 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860b35)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b5448)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b416a)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abfe1)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e3fb)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180000c480 by thread T7:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfa1)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021c00 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800021c00 by thread T7:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863aa1)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021c38 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800021c38 by thread T7:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x84898c)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021ca0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800021ca0 by thread T7:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x86240c)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021ce8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800021ce8 by thread T7:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b6415)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b52f2)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b3a07)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b34dc)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b11e2)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862442)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021fb0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800021fb3 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x865180)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862466)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800021fb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800021fbe by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8648d2)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c8debe5f0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c8debe5f0 by thread T16:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x8580f7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3ff1)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c8f8be560 by thread T10:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 (titan_thread_safety_test+0x858672)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e482c)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c8f8be560 by thread T13:
    #0 rocksdb::WriteThread::CompleteParallelMemTableWriter(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:578 (titan_thread_safety_test+0x858de8)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:147 (titan_thread_safety_test+0x6e41ce)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c8f8be568 by thread T10:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 (titan_thread_safety_test+0x6e50d6)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c8f8be568 by thread T13:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4104)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 in rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800031c4b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2cfa)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b51a8)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c4b by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad070)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b7800031c43 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670af5)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686325)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b51fa)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800031c43 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x7579dc)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad05a)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800031c40 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f66c)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x930533)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b5416)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c40 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad00b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800031c4d by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa2765a)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x685496)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c4d by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800031bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031bbe by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x8657c4)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865c06)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c989be5f8 by thread T11 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x8579a0)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x8598af)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa068)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c989be5f8 by thread T16:
    #0 rocksdb::WriteThread::WriteGroup::Iterator::operator++() /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.h:100 (titan_thread_safety_test+0x6ecf0a)
    #1 rocksdb::WriteThread::LaunchParallelMemTableWriters(rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:569 (titan_thread_safety_test+0x858d9d)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:341 (titan_thread_safety_test+0x6e5217)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x9864d2)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1ab0)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696fd4)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62569e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800031bc0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031bc1 by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac7b1)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865c98)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800031bf8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800031bfe by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864402)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780004184b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2cfa)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b51a8)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780004184b by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad070)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800041400 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800041841 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f66c)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x930533)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b5416)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800041841 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad00b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800041400 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780004184c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f431)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f5b5)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a8ec)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x685965)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x6854c8)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780004184c by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800041400 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b1800029340 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860b35)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b5448)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b416a)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abfcf)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e3fb)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b1800029340 by thread T16:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac358)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac553)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x847104)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x84848c)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845c72)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b18000292e0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x860b35)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b5448)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b416a)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abfe1)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e3fb)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b18000292e0 by thread T16:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfa1)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800051000 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800051000 by thread T16:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863aa1)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800051038 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800051038 by thread T16:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x84898c)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000510a0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000510a0 by thread T16:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x86240c)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000510e8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000510e8 by thread T16:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b6415)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b52f2)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b3a07)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b34dc)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b11e2)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862442)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c8debe5f8 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x8579a0)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c8debe5f8 by thread T7:
    #0 rocksdb::WriteThread::WriteGroup::Iterator::operator++() /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.h:100 (titan_thread_safety_test+0x6ecf0a)
    #1 rocksdb::WriteThread::LaunchParallelMemTableWriters(rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:569 (titan_thread_safety_test+0x858d9d)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:341 (titan_thread_safety_test+0x6e5217)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000513b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000513bf by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac7b1)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865c98)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000513c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000513c0 by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac7b1)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865c51)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000513f0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000513f0 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x865180)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862466)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861c0d)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x8606c3)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7acfbf)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000513f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000513ff by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8648d2)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800034efd by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa2765a)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x685496)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800034efd by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800034800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b7800043ec3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670af5)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686325)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b51fa)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800043ec3 by thread T13:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x7579dc)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad05a)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800043800 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b78000267cb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2cfa)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b51a8)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000267cb by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad070)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800026400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b78000267c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670af5)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686325)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b51fa)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000267c3 by thread T7:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x7579dc)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad05a)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800026400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b78000267bf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::IterKey::SetKeyImpl(rocksdb::Slice const&, bool) <null> (titan_thread_safety_test+0x757f06)
    #2 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:416 (titan_thread_safety_test+0x786963)
    #3 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:424 (titan_thread_safety_test+0x9b6fdb)
    #4 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:253 (titan_thread_safety_test+0x9b546c)
    #5 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #6 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #7 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #8 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #9 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #10 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #11 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #12 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #13 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #14 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #15 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #16 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #17 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #20 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #21 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #22 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000267bf by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad00b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800026400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7f3c962b16e8 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x8579a0)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858fba)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e4466)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f3c962b16e8 by thread T11 (mutexes: write M927):
    #0 void std::swap<rocksdb::FileMetaData**>(rocksdb::FileMetaData**&, rocksdb::FileMetaData**&) /usr/include/c++/4.8.2/bits/move.h:176 (titan_thread_safety_test+0x9b3fd4)
    #1 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl::_M_swap_data(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl&) /usr/include/c++/4.8.2/bits/stl_vector.h:104 (titan_thread_safety_test+0x9b3cdb)
    #2 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_base(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:144 (titan_thread_safety_test+0x9b370b)
    #3 std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::vector(std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:328 (titan_thread_safety_test+0x9b2ea5)
    #4 rocksdb::Compaction::Compaction(rocksdb::VersionStorageInfo*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, std::vector<rocksdb::CompactionInputFiles, std::allocator<rocksdb::CompactionInputFiles> >, int, unsigned long, unsigned long, unsigned int, rocksdb::CompressionType, rocksdb::CompressionOptions, unsigned int, std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >, bool, double, bool, rocksdb::CompactionReason) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:245 (titan_thread_safety_test+0x9b0a00)
    #5 rocksdb::CompactionPicker::CompactRange(std::string const&, rocksdb::MutableCFOptions const&, rocksdb::VersionStorageInfo*, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_picker.cc:732 (titan_thread_safety_test+0x9d5f56)
    #6 rocksdb::ColumnFamilyData::CompactRange(rocksdb::MutableCFOptions const&, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:995 (titan_thread_safety_test+0x9a16a5)
    #7 rocksdb::DBImpl::RunManualCompaction(rocksdb::ColumnFamilyData*, int, int, unsigned int, unsigned int, rocksdb::Slice const*, rocksdb::Slice const*, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1387 (titan_thread_safety_test+0x6f9526)
    #8 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:715 (titan_thread_safety_test+0x6f4fe3)
    #9 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x9864d2)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1ab0)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696fd4)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62569e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800028bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800028bb8 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x8651f4)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863add)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000603b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000603b8 by thread T7:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac78e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865c98)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000603c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000603c0 by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86420d)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780005dfb8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2c16)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b515d)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780005dfb8 by thread T16:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7acfe0)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780005dc00 allocated by thread T17:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T17 (tid=158630, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b7800060ff0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800060ff0 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x8651f4)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863add)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000813b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000813bd by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x86420d)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000783b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000783b8 by thread T10:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:230 (titan_thread_safety_test+0x7ac71a)
    #3 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864402)
    #4 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #5 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #6 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800078fc0 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2c16)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b515d)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4aff)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998f95)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800078fc0 by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7acfe0)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800078c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b780002dfb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780002dfb8 by thread T13:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac78e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865c98)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c972b3920 by thread T17 (mutexes: write M927):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x8598af)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6fa068)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c972b3920 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9d90)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f867b)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62ed38)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b49b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Mutex M927 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x9864d2)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1ab0)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696fd4)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:209 (titan_thread_safety_test+0x62569e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T17 (tid=158630, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c8f8be920 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c8f8be920 by thread T13:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9d90)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f867b)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62ed38)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b49b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000a6bf8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000a6bfe by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac7b1)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865c51)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b780008afb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780008afb8 by thread T7:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:230 (titan_thread_safety_test+0x7ac71a)
    #3 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864402)
    #4 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #5 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #6 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000717f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000717f8 by thread T16:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:231 (titan_thread_safety_test+0x7ac72e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x8657c4)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865c06)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780006e838 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2c16)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b515d)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780006e838 by thread T16:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7acfe0)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780006e400 allocated by thread T17:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T17 (tid=158630, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b780007cbf8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780007cbf8 by thread T13:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:231 (titan_thread_safety_test+0x7ac72e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x8657c4)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865c06)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b780007b3c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780007b3c0 by thread T10:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac78e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865c51)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b780010eff8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780010efff by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x6762b9)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x9304ef)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x76149f)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac751)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x8657c4)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865c06)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e4155)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7b78000f03b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e403)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b3b81)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b4137)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd6ee)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000f03b8 by thread T16:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac78e)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x865306)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865c51)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865490)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864017)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861dc2)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x860875)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad62a)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 1 at 0x7bc4000a0000 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x9495c7)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x94594f)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab479)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab193)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e83f2)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8705)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7bc4000a0000 by thread T10:
    #0 write <null> (libtsan.so.0+0x336a3)
    #1 rocksdb::PosixWritableFile::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/env/io_posix.cc:757 (titan_thread_safety_test+0x9963fd)
    #2 rocksdb::WritableFileWriter::WriteBuffered(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:454 (titan_thread_safety_test+0x9472cc)
    #3 rocksdb::WritableFileWriter::Flush() /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:335 (titan_thread_safety_test+0x94650d)
    #4 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:138 (titan_thread_safety_test+0x7ab528)
    #5 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab193)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e83f2)
    #7 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8705)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000a0000 allocated by thread T17:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c85c)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cbee)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eb9a9)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T17 (tid=158630, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Write of size 8 at 0x7bc4000a0008 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x9495c7)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x94594f)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab4cc)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab193)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e83f2)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8705)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7bc4000a0008 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x9495c7)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x94594f)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab4cc)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab193)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e83f2)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8705)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000a0000 allocated by thread T17:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c85c)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cbee)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eb9a9)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T17 (tid=158630, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 4 at 0x7b180000ddc0 by thread T10:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670a9e)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x8439f2)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4984)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b180000ddc0 by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180000dda0 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b180000ddd0 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180000ddd7 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:644 (titan_thread_safety_test+0x843c80)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180000dda0 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 4 at 0x7b180004cca0 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670a9e)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x8439f2)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4984)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180004cca3 by thread T10:
    #0 memset <null> (libtsan.so.0+0x32235)
    #1 std::string::append(unsigned long, char) <null> (libstdc++.so.6+0xd528b)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180004cc80 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 4 at 0x7b1800063e60 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x670a9e)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x8439f2)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e4984)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b1800063e60 by thread T16:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x670b62)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x843a41)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843bff)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800063e40 allocated by thread T16:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b180004cca7 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180004cca7 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843c66)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843d52)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec3f0)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180004cc80 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b180004cca8 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e8248)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e85b1)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4d04)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b180004cca8 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180004cc80 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec3cb)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:182 (titan_thread_safety_test+0x60bc9a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T10 (tid=158608, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780010904b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66ccf7)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b0b4f)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2cfa)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b51a8)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780010904b by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fd45)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7ad070)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800108c00 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b7800109041 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f66c)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x930533)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b5416)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800109041 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ad00b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800108c00 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b780010904c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa2765a)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x685496)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780010904c by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800108c00 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T14 (tid=158617, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7b78000e9853 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670af5)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686325)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b51fa)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4cef)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x9990b5)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000e9853 by thread T7:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x7579dc)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7ad05a)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000e9400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 1 at 0x7b78000e985f by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f431)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f5b5)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a8ec)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x685965)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x6854c8)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998ff3)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a4f4)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x779021)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f157a)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1c82)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fcfe4)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd3a0)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc443)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44c61)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43f41)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa42684)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345a9)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3de55)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3dfd1)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46abe)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa468ff)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa46863)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000e985f by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7ad09b)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x8489f1)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x8491e6)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x842b69)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845be7)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e5371)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000e9400 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0b1c)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eba8d)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9e1e)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4be3)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e80c)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b92f)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cf3d)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=158562, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e201)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3e0d1)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ebe6)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98bad0)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730990)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e53)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x737537)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x7372da)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:164 (titan_thread_safety_test+0x625062)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620f2c)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d7d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x6114f7)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c121)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T8 (tid=158602, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c962b1be0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858fba)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e4466)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c962b1be0 by thread T11:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0e3f)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0b1e)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c962b17d0 by thread T16:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858fba)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e4466)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c962b17d0 by thread T11:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a77fc)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0b9d)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T11 (tid=158609, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c972b3be0 by thread T13:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c972b3be0 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0e3f)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0b1e)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c972b37d0 by thread T13:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x859553)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e587c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c972b37d0 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a77fc)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0b9d)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c8debebe0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x8598af)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2814 (titan_thread_safety_test+0x6a7b6a)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0b9d)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c8debebe0 by thread T16:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0e3f)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0b1e)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Thread T7 (tid=158601, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d27a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cd0c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=158559)
  Read of size 8 at 0x7f3c8debe7d0 by thread T13:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85790b)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x85848e)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e482c)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e39c2)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec443)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e376d)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62debb)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611b40)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b3ea)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cdba)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x614518)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:187 (titan_thread_safety_test+0x60bd44)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f3c8debe7d0 by thread T16:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857702)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x859735)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a77fc)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0b9d)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:295 (titan_thread_safety_test+0x62602e)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fd9e)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:200 (titan_thread_safety_test+0x60becc)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f0c9)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60efaf)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60ef13)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Thread T13 (tid=158616, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

  Thread T16 (tid=158629, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da9b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d993)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d1de)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60ccd8)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:203 (titan_thread_safety_test+0x60c6d7)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6fc2)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0fb1)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa394e)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa41eb)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa4a09)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac40b)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7fac)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1e7b)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaae4e)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x611114)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:215 (titan_thread_safety_test+0x60ca2e)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
ThreadSanitizer: reported 95 warnings
