==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7fffd46ba2c0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e56f0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffd46ba2c0 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::CreateColumnFamilyImpl(rocksdb::ColumnFamilyOptions const&, std::string const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1584 (titan_thread_safety_test+0x6a02a6)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1521 (titan_thread_safety_test+0x69fcd8)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:279 (titan_thread_safety_test+0x625c85)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610c4e)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c406)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001d2c0)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f800a4b26e0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e56f0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f800a4b26e0 by thread T8:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9c04)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T8.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f8009cb15f0 by thread T8 (mutexes: write M926):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x859723)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6f9edc)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f8009cb15f0 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x857f6b)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3e65)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7fffd46ba150 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x858302)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e46a0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffd46ba150 by main thread:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a7670)
    #3 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1531 (titan_thread_safety_test+0x69fd54)
    #4 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:279 (titan_thread_safety_test+0x625c85)
    #5 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610c4e)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c406)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001d150)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7fffd46ba088 by thread T7:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:433 (titan_thread_safety_test+0x858340)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e46a0)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7fffd46ba088 by main thread:
    #0 void std::swap<char const*>(char const*&, char const*&) /usr/include/c++/4.8.2/bits/move.h:175 (titan_thread_safety_test+0x632b02)
    #1 rocksdb::Status::operator=(rocksdb::Status&&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/status.h:336 (titan_thread_safety_test+0x629997)
    #2 rocksdb::Status::Status(rocksdb::Status&&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/status.h:319 (titan_thread_safety_test+0x629875)
    #3 rocksdb::DBImpl::CreateColumnFamilyImpl(rocksdb::ColumnFamilyOptions const&, std::string const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1629 (titan_thread_safety_test+0x6a0729)
    #4 rocksdb::DBImpl::CreateColumnFamilies(std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1521 (titan_thread_safety_test+0x69fcd8)
    #5 rocksdb::titandb::TitanDBImpl::CreateColumnFamilies(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:279 (titan_thread_safety_test+0x625c85)
    #6 rocksdb::titandb::TitanDB::CreateColumnFamily(rocksdb::titandb::TitanCFDescriptor const&, rocksdb::ColumnFamilyHandle**) /home/pingcap/tabokie/titan/include/titan/db.h:40 (titan_thread_safety_test+0x610c4e)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:173 (titan_thread_safety_test+0x60c406)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001d088)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:433 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f800b1be5f0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e56f0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f800b1be5f0 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x857f6b)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3e65)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 4 at 0x7b1800015fe0 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x6708f2)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843866)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e47f8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b1800015fe0 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b1800015ff0 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800015ff7 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:644 (titan_thread_safety_test+0x843af4)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800015fc0 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7f8008caf6e8 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x857814)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858e2e)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e42da)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f8008caf6e8 by thread T11 (mutexes: write M926):
    #0 void std::swap<rocksdb::FileMetaData**>(rocksdb::FileMetaData**&, rocksdb::FileMetaData**&) /usr/include/c++/4.8.2/bits/move.h:176 (titan_thread_safety_test+0x9b3e48)
    #1 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl::_M_swap_data(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_impl&) /usr/include/c++/4.8.2/bits/stl_vector.h:104 (titan_thread_safety_test+0x9b3b4f)
    #2 std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::_Vector_base(std::_Vector_base<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:144 (titan_thread_safety_test+0x9b357f)
    #3 std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >::vector(std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >&&) /usr/include/c++/4.8.2/bits/stl_vector.h:328 (titan_thread_safety_test+0x9b2d19)
    #4 rocksdb::Compaction::Compaction(rocksdb::VersionStorageInfo*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, std::vector<rocksdb::CompactionInputFiles, std::allocator<rocksdb::CompactionInputFiles> >, int, unsigned long, unsigned long, unsigned int, rocksdb::CompressionType, rocksdb::CompressionOptions, unsigned int, std::vector<rocksdb::FileMetaData*, std::allocator<rocksdb::FileMetaData*> >, bool, double, bool, rocksdb::CompactionReason) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:245 (titan_thread_safety_test+0x9b0874)
    #5 rocksdb::CompactionPicker::CompactRange(std::string const&, rocksdb::MutableCFOptions const&, rocksdb::VersionStorageInfo*, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_picker.cc:732 (titan_thread_safety_test+0x9d5dca)
    #6 rocksdb::ColumnFamilyData::CompactRange(rocksdb::MutableCFOptions const&, int, int, unsigned int, unsigned int, rocksdb::InternalKey const*, rocksdb::InternalKey const*, rocksdb::InternalKey**, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:995 (titan_thread_safety_test+0x9a1519)
    #7 rocksdb::DBImpl::RunManualCompaction(rocksdb::ColumnFamilyData*, int, int, unsigned int, unsigned int, rocksdb::Slice const*, rocksdb::Slice const*, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1387 (titan_thread_safety_test+0x6f939a)
    #8 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:715 (titan_thread_safety_test+0x6f4e57)
    #9 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T11.

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 4 at 0x7b1800009020 by thread T10:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x6708f2)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843866)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e47f8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b1800009020 by thread T7:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x6709b6)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x8438b5)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843a73)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800009000 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b1800020007 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800020007 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843ada)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b180001ffe0 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7f800b1be560 by thread T7:
    #0 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 (titan_thread_safety_test+0x8584e6)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e46a0)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f800b1be560 by thread T10:
    #0 rocksdb::WriteThread::CompleteParallelMemTableWriter(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:578 (titan_thread_safety_test+0x858c5c)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:387 (titan_thread_safety_test+0x6e541b)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:467 in rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800030fcb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800030fcb by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800030c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7f800b1be568 by thread T7:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 (titan_thread_safety_test+0x6e4f4a)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f800b1be568 by thread T10:
    #0 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:349 (titan_thread_safety_test+0x6e50e9)
    #1 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:332 in rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b7800030fc3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800030fc3 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800030c00 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f80008be5f0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858e2e)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e42da)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f80008be5f0 by thread T16:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::JoinBatchGroup(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:368 (titan_thread_safety_test+0x857f6b)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:129 (titan_thread_safety_test+0x6e3e65)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800031c0b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c0b by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800031c0c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f285)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f409)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a760)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6857d9)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x68533c)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800031c0c by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800031800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000327b8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2a8a)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b4fd1)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000327b8 by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ace54)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800032400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000327cb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000327cb by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800032400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b78000327c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000327c3 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800032400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000327bf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::IterKey::SetKeyImpl(rocksdb::Slice const&, bool) <null> (titan_thread_safety_test+0x757d7a)
    #2 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:416 (titan_thread_safety_test+0x7867d7)
    #3 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:424 (titan_thread_safety_test+0x9b6e4f)
    #4 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:253 (titan_thread_safety_test+0x9b52e0)
    #5 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #6 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #7 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #8 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #9 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #10 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #11 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #12 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #13 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #14 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #15 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #16 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #17 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #20 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #21 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #22 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000327bf by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800032400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000327cc by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa274ce)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x68530a)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000327cc by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800032400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7f80008be5f8 by thread T8 (mutexes: write M926):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 (titan_thread_safety_test+0x857814)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x859723)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6f9edc)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7f80008be5f8 by thread T10:
    #0 rocksdb::WriteThread::WriteGroup::Iterator::operator++() /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.h:100 (titan_thread_safety_test+0x6ecd7e)
    #1 rocksdb::WriteThread::LaunchParallelMemTableWriters(rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:569 (titan_thread_safety_test+0x858c11)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:341 (titan_thread_safety_test+0x6e508b)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T16.

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:287 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800024501 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f5fc)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9303a7)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b528a)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800024501 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800024000 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b180000c960 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe43)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180000c960 by thread T7:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac1cc)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac3c7)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x846f78)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x848300)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845ae6)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b180000c900 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe55)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b180000c900 by thread T7:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace15)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800024000 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800024000 by thread T7:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863915)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800024038 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800024038 by thread T7:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x848800)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 1 at 0x7bc4000b4000 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x94943b)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9457c3)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:133 (titan_thread_safety_test+0x7ab2ed)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab007)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e8266)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8579)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7bc4000b4000 by thread T16:
    #0 write <null> (libtsan.so.0+0x336a3)
    #1 rocksdb::PosixWritableFile::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/env/io_posix.cc:757 (titan_thread_safety_test+0x996271)
    #2 rocksdb::WritableFileWriter::WriteBuffered(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:454 (titan_thread_safety_test+0x947140)
    #3 rocksdb::WritableFileWriter::Flush() /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:335 (titan_thread_safety_test+0x946381)
    #4 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:138 (titan_thread_safety_test+0x7ab39c)
    #5 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab007)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e8266)
    #7 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8579)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000b4000 allocated by thread T8:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eb81d)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000240a0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000240a0 by thread T7:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862280)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7bc4000b4008 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x94943b)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9457c3)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab340)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab007)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e8266)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8579)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7bc4000b4008 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::AlignedBuffer::Append(char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:142 (titan_thread_safety_test+0x94943b)
    #2 rocksdb::WritableFileWriter::Append(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.cc:233 (titan_thread_safety_test+0x9457c3)
    #3 rocksdb::log::Writer::EmitPhysicalRecord(rocksdb::log::RecordType, char const*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:135 (titan_thread_safety_test+0x7ab340)
    #4 rocksdb::log::Writer::AddRecord(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/log_writer.cc:87 (titan_thread_safety_test+0x7ab007)
    #5 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteBatch const&, rocksdb::log::Writer*, unsigned long*, unsigned long*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:838 (titan_thread_safety_test+0x6e8266)
    #6 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:876 (titan_thread_safety_test+0x6e8579)
    #7 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #8 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #9 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #10 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #11 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #12 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #14 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #15 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 66048 at 0x7bc4000b4000 allocated by thread T8:
    #0 operator new[](unsigned long) <null> (libtsan.so.0+0x73f9a)
    #1 rocksdb::AlignedBuffer::AllocateNewBuffer(unsigned long, bool, unsigned long, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/aligned_buffer.h:118 (titan_thread_safety_test+0x62c8e8)
    #2 rocksdb::WritableFileWriter::WritableFileWriter(std::unique_ptr<rocksdb::WritableFile, std::default_delete<rocksdb::WritableFile> >&&, std::string const&, rocksdb::EnvOptions const&, rocksdb::Statistics*, std::vector<std::shared_ptr<rocksdb::EventListener>, std::allocator<std::shared_ptr<rocksdb::EventListener> > > const&) /home/pingcap/tabokie/titan/build/rocksdb/util/file_reader_writer.h:217 (titan_thread_safety_test+0x62cc7a)
    #3 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1460 (titan_thread_safety_test+0x6eb81d)
    #4 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #5 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #6 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000240e8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000240e8 by thread T7:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b6289)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b5166)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b387b)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b3350)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b1056)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8622b6)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000243b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000243be by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac625)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x86517a)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865ac5)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000243c0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000243c2 by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac625)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x86517a)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865b0c)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b780005174b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780005174b by thread T16:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800051000 allocated by thread T17:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800051741 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f5fc)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9303a7)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b528a)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800051741 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800051000 allocated by thread T17:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b780005174c by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa274ce)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x68530a)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780005174c by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800051000 allocated by thread T17:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b1800029340 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe43)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b1800029340 by thread T16:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac1cc)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac3c7)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x846f78)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x848300)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845ae6)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b18000292e0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe55)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b18000292e0 by thread T16:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace15)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800051000 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800051000 by thread T16:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863915)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800051038 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800051038 by thread T16:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x848800)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000510a0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000510a0 by thread T16:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862280)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000510e8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000510e8 by thread T16:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b6289)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b5166)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b387b)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b3350)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b1056)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8622b6)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000513c8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000513ce by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac625)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x86517a)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:690 (titan_thread_safety_test+0x865ac5)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000513d0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000513d1 by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:240 (titan_thread_safety_test+0x7ac625)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x86517a)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865b0c)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b7800034fc3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800034fc3 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800034800 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000357f0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000357f0 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x865068)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863951)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000357f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000357ff by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864276)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800037bb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800037bbf by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864276)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800037bf0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800037bf0 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::UnstashHeight() const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:296 (titan_thread_safety_test+0x865068)
    #2 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863951)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #4 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b780002a3b8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2a8a)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b4fd1)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780002a3b8 by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ace54)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002a000 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b780002a3bf by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::IterKey::SetKeyImpl(rocksdb::Slice const&, bool) <null> (titan_thread_safety_test+0x757d7a)
    #2 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:416 (titan_thread_safety_test+0x7867d7)
    #3 rocksdb::IterKey::SetInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:424 (titan_thread_safety_test+0x9b6e4f)
    #4 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:253 (titan_thread_safety_test+0x9b52e0)
    #5 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #6 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #7 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #8 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #9 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #10 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #11 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #12 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #13 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #14 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #15 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #16 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #17 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #20 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #21 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #22 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780002a3bf by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002a000 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b780002a3d0 by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f285)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f409)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a760)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6857d9)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x68533c)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b780002a3d0 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780002a000 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800057fb0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800057fb0 by thread T16:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x864ff4)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8622da)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b780003e803 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b780003e803 by thread T10:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b780003e400 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780003e7b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780003e7b8 by thread T10:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:230 (titan_thread_safety_test+0x7ac58e)
    #3 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864276)
    #4 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #5 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #6 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780005c7b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780005c7be by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:441 (titan_thread_safety_test+0x865638)
    #6 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:688 (titan_thread_safety_test+0x865a7a)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #8 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #9 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #10 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #11 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #12 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #13 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #14 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #15 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #16 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #17 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #18 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #19 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #20 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #21 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #23 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #24 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #25 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #26 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #27 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #28 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #29 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780005c7f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780005c7fc by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864081)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800081ff8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800081fff by thread T16:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864746)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780006b7f8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b780006b7fb by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node::StashHeight(int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:289 (titan_thread_safety_test+0x864ff4)
    #2 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8622da)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #4 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #5 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #6 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #7 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #8 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #9 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #10 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #11 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #12 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #13 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #14 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #15 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #17 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #18 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #20 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #21 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #22 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #23 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780008d3b8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780008d3b8 by thread T16:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:239 (titan_thread_safety_test+0x7ac602)
    #3 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::KeyIsAfterNode(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*) const /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:449 (titan_thread_safety_test+0x86517a)
    #4 void rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::FindSpliceForLevel<true>(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node*, int, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Node**) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:691 (titan_thread_safety_test+0x865b0c)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::RecomputeSpliceLevels(rocksdb::Slice const&, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, int) /home/pingcap/tabokie/titan/build/rocksdb/memtable/inlineskiplist.h:708 (titan_thread_safety_test+0x865304)
    #6 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863e8b)
    #7 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #8 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #9 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #10 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #11 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #12 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #13 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #14 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #15 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #16 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #17 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #18 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #19 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #21 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #22 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #23 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #24 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #25 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #26 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #27 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f8009cb1920 by thread T13:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858e2e)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e42da)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f8009cb1920 by thread T7:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9c04)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f84ef)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62edc4)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b42b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T7.

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f800b1be920 by thread T14 (mutexes: write M926):
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitUnbatched(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:745 (titan_thread_safety_test+0x859723)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1489 (titan_thread_safety_test+0x6f9edc)
    #3 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #4 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f800b1be920 by thread T10:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1464 (titan_thread_safety_test+0x6f9c04)
    #3 rocksdb::DBImpl::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1249 (titan_thread_safety_test+0x6f84ef)
    #4 rocksdb::StackableDB::Flush(rocksdb::FlushOptions const&, rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:280 (titan_thread_safety_test+0x62edc4)
    #5 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:152 (titan_thread_safety_test+0x60b42b)
    #6 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #7 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #9 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #10 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #11 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #12 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T10.

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b7800096448 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2a8a)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b4fd1)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b7800096448 by thread T10:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ace54)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800096000 allocated by thread T11:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T11 (tid=169506, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b780009dbd8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b780009dbde by thread T10:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8648fa)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000a0bc8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000a0bcb by thread T16:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x7613a1)
    #2 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #3 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864746)
    #4 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #5 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #6 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800077428 by thread T4 (mutexes: write M926):
    #0 operator delete[](void*) <null> (libtsan.so.0+0x7426d)
    #1 rocksdb::Arena::~Arena() /home/pingcap/tabokie/titan/build/rocksdb/util/arena.cc:79 (titan_thread_safety_test+0x9291ad)
    #2 rocksdb::VersionStorageInfo::~VersionStorageInfo() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:349 (titan_thread_safety_test+0x7f1f8f)
    #3 rocksdb::Version::~Version() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:351 (titan_thread_safety_test+0x7f22af)
    #4 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc551)
    #5 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #6 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #7 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #8 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #9 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #10 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #11 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #12 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #13 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #14 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #17 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #18 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #19 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b7800077428 by thread T13:
    #0 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1238 (titan_thread_safety_test+0x7f7726)
    #1 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #2 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #3 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #4 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #5 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x7426d) in operator delete[](void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012068 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000012068 by thread T13:
    #0 PrepareNextLevel /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:276 (titan_thread_safety_test+0x7f1c73)
    #1 FilePicker /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:135 (titan_thread_safety_test+0x7f1610)
    #2 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1221 (titan_thread_safety_test+0x7f75c3)
    #3 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #4 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #5 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #6 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #7 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012070 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000012070 by thread T13:
    #0 FilePicker /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:139 (titan_thread_safety_test+0x7f165f)
    #1 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1221 (titan_thread_safety_test+0x7f75c3)
    #2 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #3 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #4 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #5 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #6 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012078 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000012078 by thread T13:
    #0 PrepareNextLevel /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:276 (titan_thread_safety_test+0x7f1c73)
    #1 GetNextFile /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:231 (titan_thread_safety_test+0x7f1ba6)
    #2 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1222 (titan_thread_safety_test+0x7f75d2)
    #3 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #4 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #5 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #6 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #7 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012080 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000012080 by thread T13:
    #0 GetNextFile /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:153 (titan_thread_safety_test+0x7f1758)
    #1 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1222 (titan_thread_safety_test+0x7f75d2)
    #2 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #3 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #4 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #5 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #6 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b80000121e0 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b80000121e0 by thread T13:
    #0 FilePicker /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:139 (titan_thread_safety_test+0x7f1683)
    #1 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1221 (titan_thread_safety_test+0x7f75c3)
    #2 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #3 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #4 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #5 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #6 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012230 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000012230 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 GetNextFile /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:178 (titan_thread_safety_test+0x7f18f3)
    #4 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1222 (titan_thread_safety_test+0x7f75d2)
    #5 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #6 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #7 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #8 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000012270 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b8000012276 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 GetNextFile /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:181 (titan_thread_safety_test+0x7f1955)
    #4 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1222 (titan_thread_safety_test+0x7f75d2)
    #5 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #6 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #7 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #8 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b80000122a0 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b80000122a7 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::Compare(rocksdb::Slice const&, rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:642 (titan_thread_safety_test+0x761193)
    #4 operator() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:67 (titan_thread_safety_test+0x7f1104)
    #5 lower_bound<rocksdb::FdWithKeyRange*, rocksdb::Slice, rocksdb::(anonymous namespace)::FindFileInRange(const rocksdb::InternalKeyComparator&, const rocksdb::LevelFilesBrief&, const rocksdb::Slice&, uint32_t, uint32_t)::__lambda6> /usr/include/c++/4.8.2/bits/stl_algo.h:2447 (titan_thread_safety_test+0x80c09f)
    #6 FindFileInRange /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:71 (titan_thread_safety_test+0x7f11aa)
    #7 PrepareNextLevel /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:316 (titan_thread_safety_test+0x7f1da4)
    #8 GetNextFile /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:231 (titan_thread_safety_test+0x7f1ba6)
    #9 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1222 (titan_thread_safety_test+0x7f75d2)
    #10 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #11 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #12 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #13 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #14 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #16 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #17 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #18 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #19 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #20 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #21 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b7800102fc0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b7800102fc4 by thread T13:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x8648fa)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b8000050288 by thread T4 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::Version::Unref() /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2055 (titan_thread_safety_test+0x7fc55d)
    #2 rocksdb::Compaction::~Compaction() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction.cc:274 (titan_thread_safety_test+0x9b0c43)
    #3 std::default_delete<rocksdb::Compaction>::operator()(rocksdb::Compaction*) const <null> (titan_thread_safety_test+0x70d7cf)
    #4 std::unique_ptr<rocksdb::Compaction, std::default_delete<rocksdb::Compaction> >::reset(rocksdb::Compaction*) <null> (titan_thread_safety_test+0x70850b)
    #5 rocksdb::DBImpl::BackgroundCompaction(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::DBImpl::PrepickedCompaction*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2578 (titan_thread_safety_test+0x700998)
    #6 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2114 (titan_thread_safety_test+0x6fd987)
    #7 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #8 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #9 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #10 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #11 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #12 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #13 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #14 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #15 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #16 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b8000050288 by thread T10:
    #0 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1238 (titan_thread_safety_test+0x7f7726)
    #1 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #2 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #3 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #4 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #5 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T4 'rocksdb:low1' (tid=169397, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:205 (titan_thread_safety_test+0x625553)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b54000d8b80 by thread T1:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::BlockBasedTable::~BlockBasedTable() /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:67 (titan_thread_safety_test+0x8c162b)
    #2 rocksdb::BlockBasedTable::~BlockBasedTable() /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:68 (titan_thread_safety_test+0x8c167d)
    #3 DeleteEntry<rocksdb::TableReader> /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:36 (titan_thread_safety_test+0x7ecbe7)
    #4 rocksdb::LRUHandle::Free() <null> (titan_thread_safety_test+0x692e3b)
    #5 rocksdb::LRUCacheShard::Erase(rocksdb::Slice const&, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/cache/lru_cache.cc:437 (titan_thread_safety_test+0x691ec5)
    #6 rocksdb::ShardedCache::Erase(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/cache/sharded_cache.cc:75 (titan_thread_safety_test+0x695d18)
    #7 rocksdb::TableCache::Evict(rocksdb::Cache*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:473 (titan_thread_safety_test+0x7ecb84)
    #8 rocksdb::DBImpl::PurgeObsoleteFiles(rocksdb::JobContext&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_files.cc:462 (titan_thread_safety_test+0x723b7c)
    #9 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2154 (titan_thread_safety_test+0x6fdcac)
    #10 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #11 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #12 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #13 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #14 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #17 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #18 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #19 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b54000d8b80 by thread T10:
    #0 rocksdb::DataBlockIter* rocksdb::BlockBasedTable::NewDataBlockIterator<rocksdb::DataBlockIter>(rocksdb::BlockBasedTable::Rep*, rocksdb::ReadOptions const&, rocksdb::BlockHandle const&, rocksdb::DataBlockIter*, bool, bool, bool, rocksdb::GetContext*, rocksdb::Status, rocksdb::FilePrefetchBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:1926 (titan_thread_safety_test+0x8dce62)
    #1 rocksdb::BlockBasedTable::Get(rocksdb::ReadOptions const&, rocksdb::Slice const&, rocksdb::GetContext*, rocksdb::SliceTransform const*, bool) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:2612 (titan_thread_safety_test+0x8cbac4)
    #2 rocksdb::TableCache::Get(rocksdb::ReadOptions const&, rocksdb::InternalKeyComparator const&, rocksdb::FileMetaData const&, rocksdb::Slice const&, rocksdb::GetContext*, rocksdb::SliceTransform const*, rocksdb::HistogramImpl*, bool, int) /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:394 (titan_thread_safety_test+0x7ec3e6)
    #3 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1238 (titan_thread_safety_test+0x7f778d)
    #4 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #5 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #6 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #7 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #8 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T1 'rocksdb:low0' (tid=169354, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:62 (titan_thread_safety_test+0x730781)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b54000d8c38 by thread T1:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::BlockBasedTable::~BlockBasedTable() /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:67 (titan_thread_safety_test+0x8c162b)
    #2 rocksdb::BlockBasedTable::~BlockBasedTable() /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:68 (titan_thread_safety_test+0x8c167d)
    #3 DeleteEntry<rocksdb::TableReader> /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:36 (titan_thread_safety_test+0x7ecbe7)
    #4 rocksdb::LRUHandle::Free() <null> (titan_thread_safety_test+0x692e3b)
    #5 rocksdb::LRUCacheShard::Erase(rocksdb::Slice const&, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/cache/lru_cache.cc:437 (titan_thread_safety_test+0x691ec5)
    #6 rocksdb::ShardedCache::Erase(rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/cache/sharded_cache.cc:75 (titan_thread_safety_test+0x695d18)
    #7 rocksdb::TableCache::Evict(rocksdb::Cache*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:473 (titan_thread_safety_test+0x7ecb84)
    #8 rocksdb::DBImpl::PurgeObsoleteFiles(rocksdb::JobContext&, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_files.cc:462 (titan_thread_safety_test+0x723b7c)
    #9 rocksdb::DBImpl::BackgroundCallCompaction(rocksdb::DBImpl::PrepickedCompaction*, rocksdb::Env::Priority) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2154 (titan_thread_safety_test+0x6fdcac)
    #10 rocksdb::DBImpl::BGWorkCompaction(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1901 (titan_thread_safety_test+0x6fc456)
    #11 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #12 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #13 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #14 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #17 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #18 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #19 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b54000d8c38 by thread T10:
    #0 rocksdb::DataBlockIter* rocksdb::BlockBasedTable::NewDataBlockIterator<rocksdb::DataBlockIter>(rocksdb::BlockBasedTable::Rep*, rocksdb::ReadOptions const&, rocksdb::BlockHandle const&, rocksdb::DataBlockIter*, bool, bool, bool, rocksdb::GetContext*, rocksdb::Status, rocksdb::FilePrefetchBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:1926 (titan_thread_safety_test+0x8dce98)
    #1 rocksdb::BlockBasedTable::Get(rocksdb::ReadOptions const&, rocksdb::Slice const&, rocksdb::GetContext*, rocksdb::SliceTransform const*, bool) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_reader.cc:2612 (titan_thread_safety_test+0x8cbac4)
    #2 rocksdb::TableCache::Get(rocksdb::ReadOptions const&, rocksdb::InternalKeyComparator const&, rocksdb::FileMetaData const&, rocksdb::Slice const&, rocksdb::GetContext*, rocksdb::SliceTransform const*, rocksdb::HistogramImpl*, bool, int) /home/pingcap/tabokie/titan/build/rocksdb/db/table_cache.cc:394 (titan_thread_safety_test+0x7ec3e6)
    #3 rocksdb::Version::Get(rocksdb::ReadOptions const&, rocksdb::LookupKey const&, rocksdb::PinnableSlice*, rocksdb::Status*, rocksdb::MergeContext*, unsigned long*, bool*, bool*, unsigned long*, rocksdb::ReadCallback*, bool*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:1238 (titan_thread_safety_test+0x7f778d)
    #4 rocksdb::DBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*, bool*, rocksdb::ReadCallback*, bool*, rocksdb::SuperVersion*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1319 (titan_thread_safety_test+0x69e5d2)
    #5 rocksdb::titandb::TitanDBImpl::GetImpl(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:357 (titan_thread_safety_test+0x62662a)
    #6 rocksdb::titandb::TitanDBImpl::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::PinnableSlice*) /home/pingcap/tabokie/titan/src/db_impl.cc:349 (titan_thread_safety_test+0x626507)
    #7 rocksdb::DB::Get(rocksdb::ReadOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, std::string*) <null> (titan_thread_safety_test+0x62a60d)
    #8 rocksdb::titandb::TitanThreadSafetyTest::VerifyCF(rocksdb::ColumnFamilyHandle*, std::map<std::string, std::string, std::less<std::string>, std::allocator<std::pair<std::string const, std::string> > > const&, rocksdb::ReadOptions) <null> (titan_thread_safety_test+0x611d80)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:153 (titan_thread_safety_test+0x60b53e)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T1 'rocksdb:low0' (tid=169354, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:62 (titan_thread_safety_test+0x730781)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7f80024be540 by thread T16:
    #0 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:869 (titan_thread_safety_test+0x6e8500)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f80024be540 by thread T13:
    #0 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:866 (titan_thread_safety_test+0x6e846b)
    #1 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #2 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #3 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #4 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #5 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #6 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #7 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #8 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #9 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #11 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #12 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #13 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #14 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:869 in rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 4 at 0x7b180000e120 by thread T13:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x6708f2)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843866)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e47f8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180000e123 by thread T10:
    #0 memset <null> (libtsan.so.0+0x32235)
    #1 std::string::append(unsigned long, char) <null> (libstdc++.so.6+0xd528b)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180000e100 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b180000e127 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180000e127 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843ada)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180000e100 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b180000e128 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b180000e128 by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180000e100 allocated by thread T10:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 4 at 0x7b180003ba20 by thread T10:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x6708f2)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843866)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e47f8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b180003ba20 by thread T13:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x6709b6)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x8438b5)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843a73)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180003ba00 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b180003ba27 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b180003ba27 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843ada)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180003ba00 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b180003ba28 by thread T10:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b180003ba28 by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b180003ba00 allocated by thread T13:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 4 at 0x7b1800062060 by thread T7:
    #0 rocksdb::DecodeFixed32(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 (titan_thread_safety_test+0x6708f2)
    #1 rocksdb::WriteBatchInternal::Count(rocksdb::WriteBatch const*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:607 (titan_thread_safety_test+0x843866)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:246 (titan_thread_safety_test+0x6e47f8)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 4 at 0x7b1800062060 by thread T16:
    #0 rocksdb::EncodeFixed32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:176 (titan_thread_safety_test+0x6709b6)
    #1 rocksdb::WriteBatchInternal::SetCount(rocksdb::WriteBatch*, int) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:611 (titan_thread_safety_test+0x8438b5)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:636 (titan_thread_safety_test+0x843a73)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 90 at 0x7b1800062040 allocated by thread T16:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:186 (titan_thread_safety_test+0x60bc2a)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T16 (tid=169513, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:124 in rocksdb::DecodeFixed32(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f101b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f101b by thread T7:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f0c00 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f1012 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f5fc)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9303a7)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b528a)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f1012 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f0c00 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f101f by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::BlockBasedTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/table/block_based_table_builder.cc:449 (titan_thread_safety_test+0xa274ce)
    #3 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:16 (titan_thread_safety_test+0x68530a)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f101f by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f0c00 allocated by thread T8:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T8 (tid=169449, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b18000559e0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe43)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b18000559e0 by thread T7:
    #0 rocksdb::MemTable::ShouldFlushNow() const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:156 (titan_thread_safety_test+0x7ac1cc)
    #1 rocksdb::MemTable::UpdateFlushState() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:203 (titan_thread_safety_test+0x7ac3c7)
    #2 rocksdb::MemTable::BatchPostProcess(rocksdb::MemTablePostProcessInfo const&) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.h:251 (titan_thread_safety_test+0x846f78)
    #3 rocksdb::MemTableInserter::PostProcess() <null> (titan_thread_safety_test+0x848300)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1810 (titan_thread_safety_test+0x845ae6)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b1800036300 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 ~SkipListRep /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:91 (titan_thread_safety_test+0x8609a9)
    #2 std::default_delete<rocksdb::MemTableRep>::operator()(rocksdb::MemTableRep*) const /usr/include/c++/4.8.2/bits/unique_ptr.h:67 (titan_thread_safety_test+0x7b52bc)
    #3 std::unique_ptr<rocksdb::MemTableRep, std::default_delete<rocksdb::MemTableRep> >::~unique_ptr() /usr/include/c++/4.8.2/bits/unique_ptr.h:184 (titan_thread_safety_test+0x7b3fde)
    #4 rocksdb::MemTable::~MemTable() /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:120 (titan_thread_safety_test+0x7abe55)
    #5 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e26f)
    #6 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #7 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #8 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #9 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #10 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #11 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #12 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #13 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #14 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #15 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #16 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #17 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #18 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b1800036300 by thread T7:
    #0 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace15)
    #1 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #2 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #3 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #4 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #5 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #6 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #7 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #8 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #9 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #10 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #12 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #13 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000f0c00 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000f0c00 by thread T7:
    #0 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x863915)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #2 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000f0c38 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000f0c38 by thread T7:
    #0 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1252 (titan_thread_safety_test+0x848800)
    #1 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #2 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #3 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000f0ca0 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000f0ca0 by thread T7:
    #0 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x862280)
    #1 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #2 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #3 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #4 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #5 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #6 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #7 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #8 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #9 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #10 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #11 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #12 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #13 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #15 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #16 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #18 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #19 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #20 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000f0ce8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b78000f0ce8 by thread T7:
    #0 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::get() const /usr/include/c++/4.8.2/bits/unique_ptr.h:417 (titan_thread_safety_test+0x7b6289)
    #1 std::unique_ptr<rocksdb::ConcurrentArena::Shard [], std::default_delete<rocksdb::ConcurrentArena::Shard []> >::operator[](unsigned long) const /usr/include/c++/4.8.2/bits/unique_ptr.h:412 (titan_thread_safety_test+0x7b5166)
    #2 rocksdb::CoreLocalArray<rocksdb::ConcurrentArena::Shard>::AccessAtCore(unsigned long) const /home/pingcap/tabokie/titan/build/rocksdb/util/core_local.h:80 (titan_thread_safety_test+0x7b387b)
    #3 char* rocksdb::ConcurrentArena::AllocateImpl<rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1}>(unsigned long, bool, rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*)::{lambda()#1} const&) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:139 (titan_thread_safety_test+0x7b3350)
    #4 rocksdb::ConcurrentArena::AllocateAligned(unsigned long, unsigned long, rocksdb::Logger*) /home/pingcap/tabokie/titan/build/rocksdb/util/concurrent_arena.h:63 (titan_thread_safety_test+0x7b1056)
    #5 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateNode(unsigned long, int) <null> (titan_thread_safety_test+0x8622b6)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::AllocateKey(unsigned long) <null> (titan_thread_safety_test+0x861a81)
    #7 Allocate /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:31 (titan_thread_safety_test+0x860537)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:483 (titan_thread_safety_test+0x7ace33)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b78000f0fb8 by thread T2:
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 rocksdb::SuperVersion::~SuperVersion() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:342 (titan_thread_safety_test+0x99e277)
    #2 rocksdb::SuperVersionContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:90 (titan_thread_safety_test+0x6b39f5)
    #3 rocksdb::JobContext::Clean() /home/pingcap/tabokie/titan/build/rocksdb/db/job_context.h:195 (titan_thread_safety_test+0x6b3fab)
    #4 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2072 (titan_thread_safety_test+0x6fd562)
    #5 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #6 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #7 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #8 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #9 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #10 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #11 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #12 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #13 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #14 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 1 at 0x7b78000f0fbf by thread T7:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::Slice::compare(rocksdb::Slice const&) const /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:241 (titan_thread_safety_test+0x67612d)
    #2 Compare /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:30 (titan_thread_safety_test+0x930363)
    #3 rocksdb::InternalKeyComparator::CompareKeySeq(rocksdb::Slice const&, rocksdb::Slice const&) const <null> (titan_thread_safety_test+0x761313)
    #4 rocksdb::MemTable::KeyComparator::operator()(char const*, char const*) const /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:232 (titan_thread_safety_test+0x7ac5c5)
    #5 bool rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Insert<true>(char const*, rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::Splice*, bool) <null> (titan_thread_safety_test+0x864276)
    #6 rocksdb::InlineSkipList<rocksdb::MemTableRep::KeyComparator const&>::InsertConcurrently(char const*) <null> (titan_thread_safety_test+0x861c36)
    #7 InsertKeyConcurrently /home/pingcap/tabokie/titan/build/rocksdb/memtable/skiplistrep.cc:58 (titan_thread_safety_test+0x8606e9)
    #8 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:541 (titan_thread_safety_test+0x7ad49e)
    #9 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #10 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #11 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #12 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #13 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #14 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #15 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #16 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #17 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #18 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #19 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #20 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #21 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #22 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #23 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #24 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #25 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #26 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f33b8 by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::key() const <null> (titan_thread_safety_test+0x7b2a8a)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:210 (titan_thread_safety_test+0x9b4fd1)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f33b8 by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:485 (titan_thread_safety_test+0x7ace54)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f3000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f33cb by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f33cb by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f3000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b78000f33c3 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::SeekToFirst() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:103 (titan_thread_safety_test+0x9b4973)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:146 (titan_thread_safety_test+0x998e09)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000f33c3 by thread T13:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f3000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000f33cc by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f285)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f409)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a760)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6857d9)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x68533c)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000f33cc by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000f3000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b1800063da7 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::DBImpl::MergeBatch(rocksdb::WriteThread::WriteGroup const&, rocksdb::WriteBatch*, unsigned long*, rocksdb::WriteBatch**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:807 (titan_thread_safety_test+0x6e80bc)
    #3 rocksdb::DBImpl::WriteToWAL(rocksdb::WriteThread::WriteGroup const&, rocksdb::log::Writer*, unsigned long*, bool, bool, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:864 (titan_thread_safety_test+0x6e8425)
    #4 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:293 (titan_thread_safety_test+0x6e4b78)
    #5 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #6 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #7 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #8 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #9 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #10 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #11 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #12 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #13 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #14 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #15 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #16 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #17 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b1800063da7 by thread T7:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::WriteBatchInternal::Put(rocksdb::WriteBatch*, unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:643 (titan_thread_safety_test+0x843ada)
    #3 rocksdb::WriteBatch::Put(rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:654 (titan_thread_safety_test+0x843bc6)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1575 (titan_thread_safety_test+0x6ec264)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 92 at 0x7b1800063d80 allocated by thread T7:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) <null> (libstdc++.so.6+0xd3f08)
    #2 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1574 (titan_thread_safety_test+0x6ec23f)
    #3 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #4 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #5 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b7800102403 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b7800102403 by thread T13:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b7800102000 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000dfc0b by thread T2:
    #0 rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 (titan_thread_safety_test+0x66cb4b)
    #1 rocksdb::GetLengthPrefixedSlice(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:406 (titan_thread_safety_test+0x7b09c3)
    #2 rocksdb::MemTableIterator::value() const <null> (titan_thread_safety_test+0x7b2b6e)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:211 (titan_thread_safety_test+0x9b501c)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000dfc0b by thread T13:
    #0 rocksdb::EncodeVarint32(char*, unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.cc:28 (titan_thread_safety_test+0x92fbb9)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:492 (titan_thread_safety_test+0x7acee4)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000df800 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:155 in rocksdb::GetVarint32Ptr(char const*, char const*, unsigned int*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7b78000dfc03 by thread T2:
    #0 rocksdb::DecodeFixed64(char const*) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 (titan_thread_safety_test+0x670949)
    #1 rocksdb::ParseInternalKey(rocksdb::Slice const&, rocksdb::ParsedInternalKey*) /home/pingcap/tabokie/titan/build/rocksdb/db/dbformat.h:262 (titan_thread_safety_test+0x686199)
    #2 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:214 (titan_thread_safety_test+0x9b506e)
    #3 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #4 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #5 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #6 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #7 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #8 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #9 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #10 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #11 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #12 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #13 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #14 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #15 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #16 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #18 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #19 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #20 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #21 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7b78000dfc03 by thread T13:
    #0 rocksdb::EncodeFixed64(char*, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:187 (titan_thread_safety_test+0x757850)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:490 (titan_thread_safety_test+0x7acece)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000df800 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/util/coding.h:138 in rocksdb::DecodeFixed64(char const*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000dfc00 by thread T2:
    #0 memcmp <null> (libtsan.so.0+0x4f152)
    #1 rocksdb::operator==(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/slice.h:231 (titan_thread_safety_test+0x60f5fc)
    #2 Equal /home/pingcap/tabokie/titan/build/rocksdb/util/comparator.cc:34 (titan_thread_safety_test+0x9303a7)
    #3 rocksdb::CompactionIterator::NextFromInput() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:250 (titan_thread_safety_test+0x9b528a)
    #4 rocksdb::CompactionIterator::Next() /home/pingcap/tabokie/titan/build/rocksdb/db/compaction_iterator.cc:141 (titan_thread_safety_test+0x9b4b63)
    #5 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:147 (titan_thread_safety_test+0x998f29)
    #6 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #7 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #8 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #9 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #10 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #11 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #12 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #13 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #14 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #15 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #16 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #17 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #18 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #19 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #20 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #21 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #22 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000dfc00 by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:486 (titan_thread_safety_test+0x7ace7f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000df800 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x4f152) in __interceptor_memcmp
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 1 at 0x7b78000dfc0d by thread T2:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 std::string::append(char const*, unsigned long) <null> (libstdc++.so.6+0xd511a)
    #2 rocksdb::titandb::BlobRecord::EncodeTo(std::string*) const /home/pingcap/tabokie/titan/src/blob_format.cc:22 (titan_thread_safety_test+0x66f285)
    #3 rocksdb::titandb::BlobEncoder::EncodeRecord(rocksdb::titandb::BlobRecord const&) /home/pingcap/tabokie/titan/src/blob_format.cc:42 (titan_thread_safety_test+0x66f409)
    #4 rocksdb::titandb::BlobFileBuilder::Add(rocksdb::titandb::BlobRecord const&, rocksdb::titandb::BlobHandle*) /home/pingcap/tabokie/titan/src/blob_file_builder.cc:21 (titan_thread_safety_test+0x68a760)
    #5 rocksdb::titandb::TitanTableBuilder::AddBlob(rocksdb::Slice const&, rocksdb::Slice const&, std::string*) /home/pingcap/tabokie/titan/src/table_builder.cc:51 (titan_thread_safety_test+0x6857d9)
    #6 rocksdb::titandb::TitanTableBuilder::Add(rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/src/table_builder.cc:21 (titan_thread_safety_test+0x68533c)
    #7 rocksdb::BuildTable(std::string const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIteratorBase<rocksdb::Slice>*, std::vector<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> >, std::allocator<std::unique_ptr<rocksdb::FragmentedRangeTombstoneIterator, std::default_delete<rocksdb::FragmentedRangeTombstoneIterator> > > >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::vector<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::allocator<std::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::string const&, std::vector<unsigned long, std::allocator<unsigned long> >, unsigned long, rocksdb::SnapshotChecker*, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int, unsigned long, unsigned long, rocksdb::Env::WriteLifeTimeHint) /home/pingcap/tabokie/titan/build/rocksdb/db/builder.cc:150 (titan_thread_safety_test+0x998e67)
    #8 rocksdb::FlushJob::WriteLevel0Table() /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:356 (titan_thread_safety_test+0x77a368)
    #9 rocksdb::FlushJob::Run(rocksdb::LogsWithPrepTracker*, rocksdb::FileMetaData*) /home/pingcap/tabokie/titan/build/rocksdb/db/flush_job.cc:224 (titan_thread_safety_test+0x778e95)
    #10 rocksdb::DBImpl::FlushMemTableToOutputFile(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, bool*, rocksdb::JobContext*, rocksdb::SuperVersionContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:169 (titan_thread_safety_test+0x6f13ee)
    #11 rocksdb::DBImpl::FlushMemTablesToOutputFiles(rocksdb::autovector<rocksdb::DBImpl::BGFlushArg, 8ul> const&, bool*, rocksdb::JobContext*, rocksdb::LogBuffer*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:229 (titan_thread_safety_test+0x6f1af6)
    #12 rocksdb::DBImpl::BackgroundFlush(bool*, rocksdb::JobContext*, rocksdb::LogBuffer*, rocksdb::FlushReason*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1997 (titan_thread_safety_test+0x6fce58)
    #13 rocksdb::DBImpl::BackgroundCallFlush() /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:2031 (titan_thread_safety_test+0x6fd214)
    #14 rocksdb::DBImpl::BGWorkFlush(void*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1889 (titan_thread_safety_test+0x6fc2b7)
    #15 void std::_Bind<void (*(void*))(void*)>::__call<void, , 0ul>(std::tuple<>&&, std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1296 (titan_thread_safety_test+0xa44ad5)
    #16 void std::_Bind<void (*(void*))(void*)>::operator()<, void>() /usr/include/c++/4.8.2/functional:1355 (titan_thread_safety_test+0xa43db5)
    #17 std::_Function_handler<void (), std::_Bind<void (*(void*))(void*)> >::_M_invoke(std::_Any_data const&) /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0xa424f8)
    #18 std::function<void ()>::operator()() const /usr/include/c++/4.8.2/functional:2471 (titan_thread_safety_test+0x6345f3)
    #19 rocksdb::ThreadPoolImpl::Impl::BGThread(unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:265 (titan_thread_safety_test+0xa3dcc9)
    #20 rocksdb::ThreadPoolImpl::Impl::BGThreadWrapper(void*) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:303 (titan_thread_safety_test+0xa3de45)
    #21 void* std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::_M_invoke<0ul>(std::_Index_tuple<0ul>) /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0xa46932)
    #22 std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)>::operator()() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0xa46773)
    #23 std::thread::_Impl<std::_Bind_simple<void* (*(rocksdb::BGThreadMetadata*))(void*)> >::_M_run() /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0xa466d7)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 1 at 0x7b78000dfc0d by thread T13:
    #0 memcpy <null> (libtsan.so.0+0x324d5)
    #1 rocksdb::MemTable::Add(unsigned long, rocksdb::ValueType, rocksdb::Slice const&, rocksdb::Slice const&, bool, rocksdb::MemTablePostProcessInfo*) /home/pingcap/tabokie/titan/build/rocksdb/db/memtable.cc:493 (titan_thread_safety_test+0x7acf0f)
    #2 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1255 (titan_thread_safety_test+0x848865)
    #3 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #4 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #5 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #6 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:139 (titan_thread_safety_test+0x6e3fc9)
    #7 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #8 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #9 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #10 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #11 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #13 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #14 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #15 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #16 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #17 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #18 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #19 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 2944 at 0x7b78000df800 allocated by thread T14:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 rocksdb::ColumnFamilyData::ConstructNewMemtable(rocksdb::MutableCFOptions const&, unsigned long) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:899 (titan_thread_safety_test+0x9a0990)
    #2 rocksdb::DBImpl::SwitchMemtable(rocksdb::ColumnFamilyData*, rocksdb::DBImpl::WriteContext*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1469 (titan_thread_safety_test+0x6eb901)
    #3 rocksdb::DBImpl::FlushMemTable(rocksdb::ColumnFamilyData*, rocksdb::FlushOptions const&, rocksdb::FlushReason, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:1468 (titan_thread_safety_test+0x6f9c92)
    #4 rocksdb::DBImpl::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_compaction_flush.cc:650 (titan_thread_safety_test+0x6f4a57)
    #5 rocksdb::StackableDB::CompactRange(rocksdb::CompactRangeOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const*, rocksdb::Slice const*) /home/pingcap/tabokie/titan/build/rocksdb/include/rocksdb/utilities/stackable_db.h:214 (titan_thread_safety_test+0x62e898)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:159 (titan_thread_safety_test+0x60b8bf)
    #7 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cecd)
    #8 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #10 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #11 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #12 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #13 <null> <null> (libstdc++.so.6+0xbd08f)

  Thread T2 'rocksdb:high0' (tid=169356, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 rocksdb::ThreadPoolImpl::Impl::StartBGThreads() /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:335 (titan_thread_safety_test+0xa3e075)
    #3 rocksdb::ThreadPoolImpl::Impl::SetBackgroundThreadsInternal(int, bool) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:321 (titan_thread_safety_test+0xa3df45)
    #4 rocksdb::ThreadPoolImpl::IncBackgroundThreadsIfNeeded(int) /home/pingcap/tabokie/titan/build/rocksdb/util/threadpool_imp.cc:457 (titan_thread_safety_test+0xa3ea5a)
    #5 IncBackgroundThreadsIfNeeded /home/pingcap/tabokie/titan/build/rocksdb/env/env_posix.cc:904 (titan_thread_safety_test+0x98b944)
    #6 rocksdb::SanitizeOptions(std::string const&, rocksdb::DBOptions const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:64 (titan_thread_safety_test+0x730804)
    #7 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696cc7)
    #8 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #9 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #10 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:167 (titan_thread_safety_test+0x624ff2)
    #11 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #13 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #14 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #15 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #16 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #17 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #18 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #19 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #20 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #21 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #22 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #23 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #24 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #25 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T14 (tid=169511, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x324d5) in memcpy
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f80000bdbd0 by thread T10:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::WriteThread::ExitAsBatchGroupFollower(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:599 (titan_thread_safety_test+0x858e2e)
    #3 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:164 (titan_thread_safety_test+0x6e42da)
    #4 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #5 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #6 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #7 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #8 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #9 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #10 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #11 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #12 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #13 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #14 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #15 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #16 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f80000bdbd0 by thread T17:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0cb3)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0992)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:299 (titan_thread_safety_test+0x626002)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60be5c)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T17.

  Thread T10 (tid=169505, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b1800002958 by thread T17 (mutexes: write M926):
    #0 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_remove_bucket_begin(unsigned long, std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*, unsigned long) /usr/include/c++/4.8.2/bits/hashtable.h:1220 (titan_thread_safety_test+0x9ade16)
    #1 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(unsigned long, std::__detail::_Hash_node_base*, std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*) /usr/include/c++/4.8.2/bits/hashtable.h:1485 (titan_thread_safety_test+0x9acb00)
    #2 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(std::__detail::_Node_const_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/hashtable.h:1470 (titan_thread_safety_test+0x9ab5ea)
    #3 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(std::__detail::_Node_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/hashtable.h:681 (titan_thread_safety_test+0x9a9fce)
    #4 std::unordered_map<unsigned int, rocksdb::ColumnFamilyData*, std::hash<unsigned int>, std::equal_to<unsigned int>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > >::erase(std::__detail::_Node_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/unordered_map.h:453 (titan_thread_safety_test+0x9a82db)
    #5 rocksdb::ColumnFamilySet::RemoveColumnFamily(rocksdb::ColumnFamilyData*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1317 (titan_thread_safety_test+0x9a2fcd)
    #6 rocksdb::ColumnFamilyData::SetDropped() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:549 (titan_thread_safety_test+0x99f47c)
    #7 rocksdb::VersionSet::ProcessManifestWrites(std::deque<rocksdb::VersionSet::ManifestWriter, std::allocator<rocksdb::VersionSet::ManifestWriter> >&, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:3125 (titan_thread_safety_test+0x801f33)
    #8 rocksdb::VersionSet::LogAndApply(rocksdb::autovector<rocksdb::ColumnFamilyData*, 8ul> const&, rocksdb::autovector<rocksdb::MutableCFOptions const*, 8ul> const&, rocksdb::autovector<rocksdb::autovector<rocksdb::VersionEdit*, 8ul>, 8ul> const&, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:3298 (titan_thread_safety_test+0x8036da)
    #9 rocksdb::VersionSet::LogAndApply(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, rocksdb::VersionEdit*, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) <null> (titan_thread_safety_test+0x6b2b43)
    #10 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1686 (titan_thread_safety_test+0x6a0d1f)
    #11 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0992)
    #12 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:299 (titan_thread_safety_test+0x626002)
    #13 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #14 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60be5c)
    #15 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #16 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #17 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #18 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b1800002958 by thread T13:
    #0 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_find_before_node(unsigned long, unsigned int const&, unsigned long) const /usr/include/c++/4.8.2/bits/hashtable.h:1159 (titan_thread_safety_test+0x9ac0d3)
    #1 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_find_node(unsigned long, unsigned int const&, unsigned long) const /usr/include/c++/4.8.2/bits/hashtable.h:604 (titan_thread_safety_test+0x9aae02)
    #2 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::find(unsigned int const&) const /usr/include/c++/4.8.2/bits/hashtable.h:1042 (titan_thread_safety_test+0x9a9b59)
    #3 std::unordered_map<unsigned int, rocksdb::ColumnFamilyData*, std::hash<unsigned int>, std::equal_to<unsigned int>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > >::find(unsigned int const&) const /usr/include/c++/4.8.2/bits/unordered_map.h:547 (titan_thread_safety_test+0x9a7f3d)
    #4 rocksdb::ColumnFamilySet::GetColumnFamily(unsigned int) const /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1242 (titan_thread_safety_test+0x9a2792)
    #5 rocksdb::ColumnFamilyMemTablesImpl::Seek(unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1327 (titan_thread_safety_test+0x9a3048)
    #6 rocksdb::MemTableInserter::SeekToColumnFamily(unsigned int, rocksdb::Status*) <null> (titan_thread_safety_test+0x848387)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1233 (titan_thread_safety_test+0x848651)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is heap block of size 88 at 0x7b1800002940 allocated by main thread:
    #0 operator new(unsigned long) <null> (libtsan.so.0+0x73eca)
    #1 __gnu_cxx::new_allocator<std::__detail::_Hash_node_base*>::allocate(unsigned long, void const*) /usr/include/c++/4.8.2/ext/new_allocator.h:104 (titan_thread_safety_test+0x64107a)
    #2 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_allocate_buckets(unsigned long) /usr/include/c++/4.8.2/bits/hashtable.h:779 (titan_thread_safety_test+0x9abf0c)
    #3 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_Hashtable(unsigned long, std::hash<unsigned int> const&, std::__detail::_Mod_range_hashing const&, std::__detail::_Default_ranged_hash const&, std::equal_to<unsigned int> const&, std::__detail::_Select1st const&, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > const&) /usr/include/c++/4.8.2/bits/hashtable.h:831 (titan_thread_safety_test+0x9aabc3)
    #4 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_Hashtable(unsigned long, std::hash<unsigned int> const&, std::equal_to<unsigned int> const&, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > const&) /usr/include/c++/4.8.2/bits/hashtable.h:397 (titan_thread_safety_test+0x9a992c)
    #5 std::unordered_map<unsigned int, rocksdb::ColumnFamilyData*, std::hash<unsigned int>, std::equal_to<unsigned int>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > >::unordered_map(unsigned long, std::hash<unsigned int> const&, std::equal_to<unsigned int> const&, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > const&) /usr/include/c++/4.8.2/bits/unordered_map.h:142 (titan_thread_safety_test+0x9a7dd2)
    #6 rocksdb::ColumnFamilySet::ColumnFamilySet(std::string const&, rocksdb::ImmutableDBOptions const*, rocksdb::EnvOptions const&, rocksdb::Cache*, rocksdb::WriteBufferManager*, rocksdb::WriteController*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1215 (titan_thread_safety_test+0x9a22d7)
    #7 rocksdb::VersionSet::VersionSet(std::string const&, rocksdb::ImmutableDBOptions const*, rocksdb::EnvOptions const&, rocksdb::Cache*, rocksdb::WriteBufferManager*, rocksdb::WriteController*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:2776 (titan_thread_safety_test+0x7ff622)
    #8 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:239 (titan_thread_safety_test+0x697821)
    #9 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #10 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #11 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #12 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #13 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #14 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #15 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #16 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #17 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #18 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #19 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #20 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #21 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #22 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #23 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #24 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #25 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #26 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/4.8.2/bits/hashtable.h:1220 in std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_remove_bucket_begin(unsigned long, std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*, unsigned long)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Write of size 8 at 0x7b080000efc0 by thread T17 (mutexes: write M926):
    #0 operator delete(void*) <null> (libtsan.so.0+0x741bd)
    #1 __gnu_cxx::new_allocator<std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false> >::deallocate(std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*, unsigned long) /usr/include/c++/4.8.2/ext/new_allocator.h:110 (titan_thread_safety_test+0x9ad48d)
    #2 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_deallocate_node(std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*) /usr/include/c++/4.8.2/bits/hashtable.h:747 (titan_thread_safety_test+0x9abfd2)
    #3 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(unsigned long, std::__detail::_Hash_node_base*, std::__detail::_Hash_node<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false>*) /usr/include/c++/4.8.2/bits/hashtable.h:1496 (titan_thread_safety_test+0x9acbbf)
    #4 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(std::__detail::_Node_const_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/hashtable.h:1470 (titan_thread_safety_test+0x9ab5ea)
    #5 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(std::__detail::_Node_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/hashtable.h:681 (titan_thread_safety_test+0x9a9fce)
    #6 std::unordered_map<unsigned int, rocksdb::ColumnFamilyData*, std::hash<unsigned int>, std::equal_to<unsigned int>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > >::erase(std::__detail::_Node_iterator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, false, false>) /usr/include/c++/4.8.2/bits/unordered_map.h:453 (titan_thread_safety_test+0x9a82db)
    #7 rocksdb::ColumnFamilySet::RemoveColumnFamily(rocksdb::ColumnFamilyData*) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1317 (titan_thread_safety_test+0x9a2fcd)
    #8 rocksdb::ColumnFamilyData::SetDropped() /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:549 (titan_thread_safety_test+0x99f47c)
    #9 rocksdb::VersionSet::ProcessManifestWrites(std::deque<rocksdb::VersionSet::ManifestWriter, std::allocator<rocksdb::VersionSet::ManifestWriter> >&, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:3125 (titan_thread_safety_test+0x801f33)
    #10 rocksdb::VersionSet::LogAndApply(rocksdb::autovector<rocksdb::ColumnFamilyData*, 8ul> const&, rocksdb::autovector<rocksdb::MutableCFOptions const*, 8ul> const&, rocksdb::autovector<rocksdb::autovector<rocksdb::VersionEdit*, 8ul>, 8ul> const&, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) /home/pingcap/tabokie/titan/build/rocksdb/db/version_set.cc:3298 (titan_thread_safety_test+0x8036da)
    #11 rocksdb::VersionSet::LogAndApply(rocksdb::ColumnFamilyData*, rocksdb::MutableCFOptions const&, rocksdb::VersionEdit*, rocksdb::InstrumentedMutex*, rocksdb::Directory*, bool, rocksdb::ColumnFamilyOptions const*) <null> (titan_thread_safety_test+0x6b2b43)
    #12 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1686 (titan_thread_safety_test+0x6a0d1f)
    #13 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0992)
    #14 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:299 (titan_thread_safety_test+0x626002)
    #15 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #16 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60be5c)
    #17 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #18 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #19 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #20 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous read of size 8 at 0x7b080000efc0 by thread T13:
    #0 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_find_before_node(unsigned long, unsigned int const&, unsigned long) const /usr/include/c++/4.8.2/bits/hashtable.h:1162 (titan_thread_safety_test+0x9ac0f7)
    #1 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_find_node(unsigned long, unsigned int const&, unsigned long) const /usr/include/c++/4.8.2/bits/hashtable.h:604 (titan_thread_safety_test+0x9aae02)
    #2 std::_Hashtable<unsigned int, std::pair<unsigned int const, rocksdb::ColumnFamilyData*>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> >, std::__detail::_Select1st, std::equal_to<unsigned int>, std::hash<unsigned int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::find(unsigned int const&) const /usr/include/c++/4.8.2/bits/hashtable.h:1042 (titan_thread_safety_test+0x9a9b59)
    #3 std::unordered_map<unsigned int, rocksdb::ColumnFamilyData*, std::hash<unsigned int>, std::equal_to<unsigned int>, std::allocator<std::pair<unsigned int const, rocksdb::ColumnFamilyData*> > >::find(unsigned int const&) const /usr/include/c++/4.8.2/bits/unordered_map.h:547 (titan_thread_safety_test+0x9a7f3d)
    #4 rocksdb::ColumnFamilySet::GetColumnFamily(unsigned int) const /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1242 (titan_thread_safety_test+0x9a2792)
    #5 rocksdb::ColumnFamilyMemTablesImpl::Seek(unsigned int) /home/pingcap/tabokie/titan/build/rocksdb/db/column_family.cc:1327 (titan_thread_safety_test+0x9a3048)
    #6 rocksdb::MemTableInserter::SeekToColumnFamily(unsigned int, rocksdb::Status*) <null> (titan_thread_safety_test+0x848387)
    #7 rocksdb::MemTableInserter::PutCFImpl(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&, rocksdb::ValueType) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1233 (titan_thread_safety_test+0x848651)
    #8 rocksdb::MemTableInserter::PutCF(unsigned int, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1329 (titan_thread_safety_test+0x84905a)
    #9 rocksdb::WriteBatch::Iterate(rocksdb::WriteBatch::Handler*) const /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:451 (titan_thread_safety_test+0x8429dd)
    #10 rocksdb::WriteBatchInternal::InsertInto(rocksdb::WriteThread::Writer*, unsigned long, rocksdb::ColumnFamilyMemTables*, rocksdb::FlushScheduler*, bool, unsigned long, rocksdb::DB*, bool, bool, unsigned long, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/write_batch.cc:1806 (titan_thread_safety_test+0x845a5b)
    #11 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:350 (titan_thread_safety_test+0x6e51e5)
    #12 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #13 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #14 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #15 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #16 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #17 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #18 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #19 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #20 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #21 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #22 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #23 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #24 <null> <null> (libstdc++.so.6+0xbd08f)

  Mutex M926 (0x7b8400000498) created at:
    #0 pthread_mutex_init <null> (libtsan.so.0+0x2c57d)
    #1 rocksdb::port::Mutex::Mutex(bool) /home/pingcap/tabokie/titan/build/rocksdb/port/port_posix.cc:42 (titan_thread_safety_test+0x986346)
    #2 rocksdb::InstrumentedMutex::InstrumentedMutex(rocksdb::Statistics*, rocksdb::Env*, int, bool) <null> (titan_thread_safety_test+0x6b1924)
    #3 rocksdb::DBImpl::DBImpl(rocksdb::DBOptions const&, std::string const&, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:223 (titan_thread_safety_test+0x696e48)
    #4 rocksdb::DBImpl::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**, bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1112 (titan_thread_safety_test+0x7373ab)
    #5 rocksdb::DB::Open(rocksdb::DBOptions const&, std::string const&, std::vector<rocksdb::ColumnFamilyDescriptor, std::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_open.cc:1086 (titan_thread_safety_test+0x73714e)
    #6 rocksdb::titandb::TitanDBImpl::Open(std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*) /home/pingcap/tabokie/titan/src/db_impl.cc:212 (titan_thread_safety_test+0x62562e)
    #7 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanDBOptions const&, std::string const&, std::vector<rocksdb::titandb::TitanCFDescriptor, std::allocator<rocksdb::titandb::TitanCFDescriptor> > const&, std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:29 (titan_thread_safety_test+0x620ebc)
    #8 rocksdb::titandb::TitanDB::Open(rocksdb::titandb::TitanOptions const&, std::string const&, rocksdb::titandb::TitanDB**) /home/pingcap/tabokie/titan/src/db.cc:15 (titan_thread_safety_test+0x620d0d)
    #9 rocksdb::titandb::TitanThreadSafetyTest::Open() <null> (titan_thread_safety_test+0x611487)
    #10 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:134 (titan_thread_safety_test+0x60c0b1)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #12 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #13 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #14 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #15 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #16 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #17 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #18 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #19 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #20 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #21 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race (/lib64/libtsan.so.0+0x741bd) in operator delete(void*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f80000bd7c0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::EnterAsBatchGroupLeader(rocksdb::WriteThread::Writer*, rocksdb::WriteThread::WriteGroup*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:425 (titan_thread_safety_test+0x858302)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:223 (titan_thread_safety_test+0x6e46a0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f80000bd7c0 by thread T17:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::WriteOptionsFile(bool, bool) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:2777 (titan_thread_safety_test+0x6a7670)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1655 (titan_thread_safety_test+0x6a0a11)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:299 (titan_thread_safety_test+0x626002)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60be5c)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T17.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T17 (tid=169514, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
==================
WARNING: ThreadSanitizer: data race (pid=169343)
  Read of size 8 at 0x7f80024bebd0 by thread T7:
    #0 rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 (titan_thread_safety_test+0x85777f)
    #1 rocksdb::WriteThread::ExitAsBatchGroupLeader(rocksdb::WriteThread::WriteGroup&, rocksdb::Status) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:699 (titan_thread_safety_test+0x8593c7)
    #2 rocksdb::DBImpl::WriteImpl(rocksdb::WriteOptions const&, rocksdb::WriteBatch*, rocksdb::WriteCallback*, unsigned long*, unsigned long, bool, unsigned long*, unsigned long, rocksdb::PreReleaseCallback*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:405 (titan_thread_safety_test+0x6e56f0)
    #3 rocksdb::DBImpl::Write(rocksdb::WriteOptions const&, rocksdb::WriteBatch*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:55 (titan_thread_safety_test+0x6e3836)
    #4 rocksdb::DB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:1579 (titan_thread_safety_test+0x6ec2b7)
    #5 rocksdb::DBImpl::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl_write.cc:25 (titan_thread_safety_test+0x6e35e1)
    #6 rocksdb::StackableDB::Put(rocksdb::WriteOptions const&, rocksdb::ColumnFamilyHandle*, rocksdb::Slice const&, rocksdb::Slice const&) <null> (titan_thread_safety_test+0x62df47)
    #7 rocksdb::titandb::TitanThreadSafetyTest::PutCF(rocksdb::ColumnFamilyHandle*, unsigned long) <null> (titan_thread_safety_test+0x611ad0)
    #8 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:149 (titan_thread_safety_test+0x60b37a)
    #9 _M_invoke /usr/include/c++/4.8.2/functional:2071 (titan_thread_safety_test+0x60cd4a)
    #10 std::function<void (rocksdb::ColumnFamilyHandle*)>::operator()(rocksdb::ColumnFamilyHandle*) const <null> (titan_thread_safety_test+0x6144a8)
    #11 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:191 (titan_thread_safety_test+0x60bcd4)
    #12 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #13 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #14 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #15 <null> <null> (libstdc++.so.6+0xbd08f)

  Previous write of size 8 at 0x7f80024bebd0 by thread T13:
    #0 rocksdb::WriteThread::LinkOne(rocksdb::WriteThread::Writer*, std::atomic<rocksdb::WriteThread::Writer*>*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:248 (titan_thread_safety_test+0x857576)
    #1 rocksdb::WriteThread::EnterUnbatched(rocksdb::WriteThread::Writer*, rocksdb::InstrumentedMutex*) /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:729 (titan_thread_safety_test+0x8595a9)
    #2 rocksdb::DBImpl::DropColumnFamilyImpl(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1685 (titan_thread_safety_test+0x6a0cb3)
    #3 rocksdb::DBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/build/rocksdb/db/db_impl.cc:1647 (titan_thread_safety_test+0x6a0992)
    #4 rocksdb::titandb::TitanDBImpl::DropColumnFamilies(std::vector<rocksdb::ColumnFamilyHandle*, std::allocator<rocksdb::ColumnFamilyHandle*> > const&) /home/pingcap/tabokie/titan/src/db_impl.cc:299 (titan_thread_safety_test+0x626002)
    #5 rocksdb::titandb::TitanDB::DropColumnFamily(rocksdb::ColumnFamilyHandle*) /home/pingcap/tabokie/titan/include/titan/db.h:71 (titan_thread_safety_test+0x62fe2a)
    #6 operator() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:204 (titan_thread_safety_test+0x60be5c)
    #7 _M_invoke<> /usr/include/c++/4.8.2/functional:1732 (titan_thread_safety_test+0x60f059)
    #8 operator() /usr/include/c++/4.8.2/functional:1720 (titan_thread_safety_test+0x60ef3f)
    #9 _M_run /usr/include/c++/4.8.2/thread:115 (titan_thread_safety_test+0x60eea3)
    #10 <null> <null> (libstdc++.so.6+0xbd08f)

  Location is stack of thread T13.

  Thread T7 (tid=169448, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 _M_emplace_back_aux<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:408 (titan_thread_safety_test+0x60d20a)
    #6 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:101 (titan_thread_safety_test+0x60cc9c)
    #7 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #9 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #10 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #11 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #12 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #13 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #14 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #15 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #16 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #17 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #18 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

  Thread T13 (tid=169510, running) created by main thread at:
    #0 pthread_create <null> (libtsan.so.0+0x2bcbe)
    #1 std::thread::_M_start_thread(std::shared_ptr<std::thread::_Impl_base>, void (*)()) <null> (libstdc++.so.6+0xbd1d2)
    #2 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/ext/new_allocator.h:120 (titan_thread_safety_test+0x60da2b)
    #3 _S_construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:254 (titan_thread_safety_test+0x60d923)
    #4 construct<std::thread, rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/alloc_traits.h:393 (titan_thread_safety_test+0x60d16e)
    #5 emplace_back<rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody()::__lambda10> /usr/include/c++/4.8.2/bits/vector.tcc:96 (titan_thread_safety_test+0x60cc68)
    #6 rocksdb::titandb::TitanThreadSafetyTest_Basic_Test::TestBody() /home/pingcap/tabokie/titan/src/thread_safety_test.cc:207 (titan_thread_safety_test+0x60c667)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac6e36)
    #8 void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac0e25)
    #9 testing::Test::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3897 (titan_thread_safety_test+0xaa37c2)
    #10 testing::TestInfo::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4072 (titan_thread_safety_test+0xaa405f)
    #11 testing::TestCase::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:4190 (titan_thread_safety_test+0xaa487d)
    #12 testing::internal::UnitTestImpl::RunAllTests() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:6062 (titan_thread_safety_test+0xaac27f)
    #13 bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3824 (titan_thread_safety_test+0xac7e20)
    #14 bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:3860 (titan_thread_safety_test+0xac1cef)
    #15 testing::UnitTest::Run() /home/pingcap/tabokie/titan/build/rocksdb/third-party/gtest-1.7.0/fused-src/gtest/gtest-all.cc:5683 (titan_thread_safety_test+0xaaacc2)
    #16 RUN_ALL_TESTS() <null> (titan_thread_safety_test+0x6110a4)
    #17 main /home/pingcap/tabokie/titan/src/thread_safety_test.cc:219 (titan_thread_safety_test+0x60c9be)

SUMMARY: ThreadSanitizer: data race /home/pingcap/tabokie/titan/build/rocksdb/db/write_thread.cc:282 in rocksdb::WriteThread::CreateMissingNewerLinks(rocksdb::WriteThread::Writer*)
==================
ThreadSanitizer: reported 113 warnings
